"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[1295],{71295:(e,t,a)=>{a.r(t),a.d(t,{default:()=>_});var i=a(72791),r=a(79271),o=a(74569),s=a.n(o),l=a(16149),n=a(89743),d=a(2677),c=a(43360),h=a(34575),f=a(19658),m=a(61889),x=a(20890),p=a(15617),u=a.n(p),j=a(82159),Z=(a(53063),a(3986)),g=a(29818),w=a(64554),b=a(39157),S=a(13239),v=a(5936),k=a(3395),C=a(872),y=a(31009),R=a(38996),D=a(5130),T=a(82271),P=a(41286),O=a(91903),I=a(12715),W=a(10111),N=a(35585),A=a(16346),B=a(5403),L=a(97911),F=a(80184);const E=i.forwardRef((function(e,t){return(0,F.jsx)(f.Z,{elevation:6,ref:t,variant:"filled",...e})}));const _=(0,r.EN)((function(e){let[t,a]=(0,i.useState)([]),[r,o]=(0,i.useState)([]);const[f,p]=(0,i.useState)(!1),[_,Q]=(0,i.useState)([]),[G,q]=(0,i.useState)(),[H,U]=(0,i.useState)(0),[V,M]=(0,i.useState)(0),[K,z]=(0,i.useState)([]);let[J,X]=(0,i.useState)(""),[$,Y]=(0,i.useState)("");const ee=s().create({baseURL:"http://35.78.68.113:8072"});let[te,ae]=(0,i.useState)({}),[ie,re]=(0,i.useState)({}),[oe,se]=(0,i.useState)(!1),[le,ne]=(0,i.useState)(!1);const de={Add:(0,i.forwardRef)(((e,t)=>(0,F.jsx)(v.Z,{...e,ref:t}))),Check:(0,i.forwardRef)(((e,t)=>(0,F.jsx)(C.Z,{...e,ref:t}))),Clear:(0,i.forwardRef)(((e,t)=>(0,F.jsx)(D.Z,{...e,ref:t}))),Delete:(0,i.forwardRef)(((e,t)=>(0,F.jsx)(T.Z,{...e,ref:t}))),DetailPanel:(0,i.forwardRef)(((e,t)=>(0,F.jsx)(R.Z,{...e,ref:t}))),Edit:(0,i.forwardRef)(((e,t)=>(0,F.jsx)(P.Z,{...e,ref:t}))),Export:(0,i.forwardRef)(((e,t)=>(0,F.jsx)(A.Z,{...e,ref:t}))),Filter:(0,i.forwardRef)(((e,t)=>(0,F.jsx)(O.Z,{...e,ref:t}))),FirstPage:(0,i.forwardRef)(((e,t)=>(0,F.jsx)(I.Z,{...e,ref:t}))),LastPage:(0,i.forwardRef)(((e,t)=>(0,F.jsx)(W.Z,{...e,ref:t}))),NextPage:(0,i.forwardRef)(((e,t)=>(0,F.jsx)(R.Z,{...e,ref:t}))),PreviousPage:(0,i.forwardRef)(((e,t)=>(0,F.jsx)(y.Z,{...e,ref:t}))),ResetSearch:(0,i.forwardRef)(((e,t)=>(0,F.jsx)(D.Z,{...e,ref:t}))),Search:(0,i.forwardRef)(((e,t)=>(0,F.jsx)(B.Z,{...e,ref:t}))),SortArrow:(0,i.forwardRef)(((e,t)=>(0,F.jsx)(k.Z,{...e,ref:t}))),ThirdStateCheck:(0,i.forwardRef)(((e,t)=>(0,F.jsx)(N.Z,{...e,ref:t}))),ViewColumn:(0,i.forwardRef)(((e,t)=>(0,F.jsx)(L.Z,{...e,ref:t})))};(0,i.useEffect)((()=>{a([{name:e.location.data.row.assignedMobitelOfficer.name}]),o([{companyName:e.location.data.row.assignedSubcon.companyName}]),ae({taskRef:e.location.data.row.taskRef,siteID:e.location.data.row.siteID,siteName:e.location.data.row.siteName,actualTaskStartDate:e.location.data.row.taskHistory.find((e=>"Task commenced"===e.taskStatus)).performedDate.split("T")[0],actualTaskCompletedDate:e.location.data.row.taskHistory.find((e=>"Task completed"===e.taskStatus)).performedDate.split("T")[0],taskAssignedDiv:e.location.data.row.taskAssignedDiv,assignedMobitelOfficer:e.location.data.row.assignedMobitelOfficer.name,workScope:e.location.data.row.workScope,assignedSubcon:e.location.data.row.assignedSubcon.companyName}),Q(e.location.data.row.boqs[e.location.data.row.boqs.length-1].boqData),q(e.location.data.row.boqs[e.location.data.row.boqs.length-1].totalCost),U(e.location.data.row.boqs[e.location.data.row.boqs.length-1].CapexPrAmount),M(e.location.data.row.boqs[e.location.data.row.boqs.length-1].OpexPrAmount),z(e.location.data.row.taskHistory.filter((e=>"BOQ Verified_0"===e.taskStatus||"BOQ Verified_1"===e.taskStatus||"BOQ Verified_2"===e.taskStatus||"BOQ Rejected"===e.taskStatus||"BOQ submitted"===e.taskStatus)))}),[]);const ce=(e,t)=>{"clickaway"!==t&&se(!1)};return(0,F.jsxs)("div",{children:[(0,F.jsxs)("div",{className:"content-wrapper",children:[(0,F.jsx)("div",{className:"content-header",children:(0,F.jsx)("section",{className:"content-header",children:(0,F.jsx)("div",{className:"container-fluid",children:(0,F.jsx)("div",{className:"row mb-2",children:(0,F.jsx)("div",{className:"col-sm-6",children:(0,F.jsxs)("h1",{children:["Approve BOQ Task ID: ",te.taskRef]})})})})})}),(0,F.jsx)("section",{className:"content",children:(0,F.jsxs)("div",{className:"container-fluid",children:[(0,F.jsxs)(l.Z,{children:[(0,F.jsxs)(n.Z,{children:[(0,F.jsxs)(l.Z.Group,{as:d.Z,children:[(0,F.jsx)(l.Z.Label,{children:"Site ID"}),(0,F.jsx)(l.Z.Control,{disabled:!0,value:te.siteID,className:"col-md-9",type:"text",placeholder:"Enter site ID",isInvalid:!!ie.siteID}),(0,F.jsx)(l.Z.Control.Feedback,{type:"invalid",children:ie.siteID})]}),(0,F.jsxs)(l.Z.Group,{as:d.Z,children:[(0,F.jsx)(l.Z.Label,{children:"Site Name"}),(0,F.jsx)(l.Z.Control,{disabled:!0,value:te.siteName,type:"text",placeholder:"Enter site Name",isInvalid:!!ie.siteName}),(0,F.jsx)(l.Z.Control.Feedback,{type:"invalid",children:ie.siteName})]}),(0,F.jsx)(l.Z.Group,{as:d.Z,controlId:""})]}),(0,F.jsxs)(n.Z,{className:"mb-3",children:[(0,F.jsxs)(l.Z.Group,{as:d.Z,children:[(0,F.jsx)(l.Z.Label,{children:"Actual Work Commencement Date"}),(0,F.jsx)(l.Z.Control,{disabled:!0,value:te.actualTaskStartDate,className:"col-md-9",type:"date",isInvalid:!!ie.actualTaskStartDate}),(0,F.jsx)(l.Z.Control.Feedback,{type:"invalid",children:ie.actualTaskStartDate})]}),(0,F.jsxs)(l.Z.Group,{as:d.Z,children:[(0,F.jsx)(l.Z.Label,{children:"Actual Work Completed Date"}),(0,F.jsx)(l.Z.Control,{disabled:!0,value:te.actualTaskCompletedDate,className:"col-md-9",type:"date",isInvalid:!!ie.actualTaskCompletedDate}),(0,F.jsx)(l.Z.Control.Feedback,{type:"invalid",children:ie.actualTaskCompletedDate})]}),(0,F.jsx)(l.Z.Group,{as:d.Z})]}),(0,F.jsxs)(n.Z,{children:[(0,F.jsxs)(l.Z.Group,{as:d.Z,children:[(0,F.jsx)(l.Z.Label,{children:"Task Assigned Division"}),(0,F.jsxs)(l.Z.Control,{disabled:!0,value:te.taskAssignedDiv,as:"select",defaultValue:"Choose...",isInvalid:!!ie.taskAssignedDiv,children:[(0,F.jsx)("option",{children:"Choose..."}),(0,F.jsx)("option",{children:"Project_Radio"}),(0,F.jsx)("option",{children:"Project_Core"}),(0,F.jsx)("option",{children:"Project_TX"}),(0,F.jsx)("option",{children:"Project_IBS"}),(0,F.jsx)("option",{children:"Project_WiFi"})]}),(0,F.jsx)(l.Z.Control.Feedback,{type:"invalid",children:ie.taskAssignedDiv})]}),(0,F.jsxs)(l.Z.Group,{as:d.Z,children:[(0,F.jsx)(l.Z.Label,{children:"Assigned Mobitel Officer"}),(0,F.jsxs)(l.Z.Control,{disabled:!0,as:"select",value:te.assignedMobitelOfficer,defaultValue:"Choose...",isInvalid:!!ie.assignedMobitelOfficer,children:[(0,F.jsx)("option",{children:"Choose..."}),t.map((e=>(0,F.jsx)("option",{value:e._id,children:e.name})))]}),(0,F.jsx)(l.Z.Control.Feedback,{type:"invalid",children:ie.assignedMobitelOfficer})]}),(0,F.jsxs)(l.Z.Group,{as:d.Z,children:[(0,F.jsx)(l.Z.Label,{children:"Assigned subcontractor"}),(0,F.jsxs)(l.Z.Control,{disabled:!0,value:te.assignedSubcon,as:"select",defaultValue:"Choose...",isInvalid:!!ie.assignedSubcon,children:[(0,F.jsx)("option",{children:"Choose..."}),r.map((e=>(0,F.jsx)("option",{value:e._id,children:e.companyName})))]}),(0,F.jsx)(l.Z.Control.Feedback,{type:"invalid",children:ie.assignedSubcon})]})]}),(0,F.jsx)(n.Z,{children:(0,F.jsxs)(l.Z.Group,{as:d.Z,children:[(0,F.jsx)(l.Z.Label,{children:"High level work scope"}),(0,F.jsx)(l.Z.Control,{disabled:!0,value:te.workScope,as:"textarea",rows:2,placeholder:"",isInvalid:!!ie.workScope}),(0,F.jsx)(l.Z.Control.Feedback,{type:"invalid",children:ie.workScope})]})})]}),(0,F.jsx)(u(),{title:"Approve BOQ-"+te.siteID+"_"+te.taskRef,data:_,columns:[{title:"ERP Code",field:"erpCode",filtering:!1,editable:!1,cellStyle:{width:100,minWidth:100,maxWidth:100,height:1}},{title:"Rate Card Div",field:"rateCardDiv",editable:!1,cellStyle:{width:100,minWidth:100,maxWidth:100,height:1}},{title:"Item Discreption",field:"itemDiscreption",filtering:!1,editable:!1,cellStyle:{width:300,minWidth:300,maxWidth:300,height:1}},{title:"UoM",field:"itemUom",editable:!1,cellStyle:{width:50,minWidth:50,maxWidth:50,height:1}},{title:"Unit Rate",field:"itemRate",editable:!1,filtering:!1,cellStyle:{width:100,minWidth:100,maxWidth:100,height:1}},{title:"Quantity",field:"itemQty",editable:!1,cellStyle:{width:50,minWidth:50,maxWidth:50,height:1}},{title:"Item Total",field:"itemTotal",type:"currency",currencySetting:{currencyCode:"LKR"},editable:!1,cellStyle:{width:100,minWidth:100,maxWidth:100,height:1}},{title:"Capex/Opex",field:"capexopexLine",cellStyle:{width:100,minWidth:100,maxWidth:100,height:1},editable:!1},{title:"Comment",field:"itemComment",editable:"onUpdate",cellStyle:{width:100,minWidth:100,maxWidth:100,height:1}}],icons:de,editable:{onRowUpdate:(e,t)=>new Promise(((a,i)=>{const r=t.tableData.id,o=[..._];e.itemTotal=e.itemRate*e.itemQty,o[r]=e,setTimeout((()=>{Q(o),a()}),2e3)}))},options:{exportButton:!0,pageSizeOptions:[_.length,5,10,20],paginationType:"stepped",showTextRowsSelected:!1,actionsColumnIndex:-1,filtering:!1,tableLayout:"auto",rowStyle:{backgroundColor:"#EEE"},headerStyle:{backgroundColor:"#01579b",color:"#FFF"}},components:{Pagination:e=>(0,F.jsxs)(F.Fragment,{children:[(0,F.jsxs)(m.ZP,{container:!0,style:{pading:300,background:"#f5f5f5"},children:[(0,F.jsxs)(m.ZP,{sm:9,item:!0,children:[(0,F.jsx)(x.Z,{align:"right",variant:"subtitle1",children:"Capex Amount"}),(0,F.jsx)(x.Z,{align:"right",variant:"subtitle1",children:"Opex Amount"}),(0,F.jsx)(x.Z,{align:"right",fontWeight:"bold",variant:"subtitle1",children:"Total Amount"})]}),(0,F.jsxs)(m.ZP,{sm:3,align:"center",children:[(0,F.jsx)(x.Z,{align:"right",variant:"subtitle1",children:"LKR "+H}),(0,F.jsx)(x.Z,{align:"right",variant:"subtitle1",children:"LKR "+V}),(0,F.jsx)(x.Z,{align:"right",fontWeight:"bold",variant:"subtitle1",children:"LKR "+G})]})]}),(0,F.jsx)(j.Z,{...e})]})}}),(0,F.jsx)("br",{}),(0,F.jsx)(n.Z,{children:(0,F.jsxs)(l.Z.Group,{as:d.Z,children:[(0,F.jsx)(l.Z.Label,{children:"Task History"}),(0,F.jsx)("div",{style:{height:250,width:"100%"},children:(0,F.jsx)(Z._$r,{getRowId:e=>e._id,rows:K,columns:[{field:"taskStatus",headerName:"Status",width:250},{field:"performedDate",headerName:"Performed Date",width:200,valueGetter:e=>e.row.performedDate.split("T")[0]},{field:"performedBy",headerName:"Performed by",width:200,valueGetter:e=>e.row.performedBy.name},{field:"comment",headerName:"Comment",width:500}],pageSize:5,rowsPerPageOptions:[5],rowHeight:30,headerHeight:40})})]})}),(0,F.jsx)(n.Z,{children:(0,F.jsxs)(l.Z.Group,{as:d.Z,children:[(0,F.jsx)(l.Z.Label,{children:"Comments"}),(0,F.jsx)(l.Z.Control,{onChange:e=>{return t="comment",a=e.target.value,ae({...te,[t]:a}),void(ie[t]&&re({...ie,[t]:null}));var t,a},as:"textarea",rows:2,value:te.comment,placeholder:"Enter your comments",isInvalid:!!ie.comment}),(0,F.jsx)(l.Z.Control.Feedback,{type:"invalid",children:ie.comment})]})}),(0,F.jsx)(c.Z,{variant:"warning",onClick:t=>{t.preventDefault();const a=(()=>{const{comment:e}=te,t={};return e&&""!==e||(t.comment="cannot be blank!"),t})();if(Object.keys(a).length>0)re(a);else{const t={taskStatus:"BOQ Rejected"};ee.put("projonline/update/"+e.location.data.row._id,{totalCost:G,boqData:_,taskObject:t,taskHistory:{taskStatus:"BOQ Rejected",comment:te.comment}},{headers:{token:"Bearer "+JSON.parse(localStorage.getItem("user")).accessToken}}).then((t=>{ne(!0),setTimeout((()=>{Y(t.data.alart),X(t.data.severity),se(!0)}),2e3),setTimeout((()=>{ne(!1),se(!1),e.history.push({pathname:"/approveBoqTasks"})}),5e3)})).catch((e=>{console.log(e)}))}},children:"BOQ Rejected"})," ",(0,F.jsx)(c.Z,{variant:"primary",onClick:t=>{t.preventDefault();const a=(()=>{const{comment:e}=te,t={};return e&&""!==e||(t.comment="cannot be blank!"),t})();if(Object.keys(a).length>0)re(a);else{let t={taskStatus:"BOQ Approved"};var i=e.location.data.row.approvalPath[e.location.data.row.approvalPath.length-1].approvalLevel;ee.put("projonline/update/"+e.location.data.row._id,{CapexPrAmount:H,OpexPrAmount:V,totalCost:G,boqData:_,taskObject:t,taskHistory:{taskStatus:t.taskStatus,comment:te.comment,otherApprovalLevel:i}},{headers:{token:"Bearer "+JSON.parse(localStorage.getItem("user")).accessToken}}).then((t=>{ne(!0),setTimeout((()=>{Y(t.data.alart),X(t.data.severity),se(!0)}),2e3),setTimeout((()=>{ne(!1),se(!1),e.history.push({pathname:"/approveBoqTasks"})}),5e3)})).catch((e=>{console.log(e)}))}},children:"BOQ Approved"})]})})]}),(0,F.jsx)(h.Z,{open:oe,autoHideDuration:6e3,onClose:ce,anchorOrigin:{vertical:"top",horizontal:"center"},children:(0,F.jsx)(E,{onClose:ce,severity:J,sx:{width:"100%"},children:$})}),(0,F.jsx)(g.Z,{open:le,onClose:ce,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:(0,F.jsx)(b.Z,{children:(0,F.jsx)(w.Z,{sx:{display:"flex"},children:(0,F.jsx)(S.Z,{})})})})]})}))},53063:(e,t,a)=>{a.d(t,{Z:()=>W});var i=a(83837),r=a(94026),o=a(1288),s=a(20269),l=a(26513),n=a(82159),d=a(72791),c=a(15617),h=a.n(c),f=a(63727),m=a(51859),x=a(74569),p=a.n(x),u=a(5936),j=a(3395),Z=a(872),g=a(31009),w=a(38996),b=a(5130),S=a(82271),v=a(41286),k=a(91903),C=a(12715),y=a(10111),R=a(35585),D=a(16346),T=a(5403),P=a(97911),O=a(80184);let I=[];function W(e){const[t,a]=(0,d.useState)(I),[c,x]=(0,d.useState)("all"),{openPopup:W,setOpenPopup:N}=e,[A,B]=(0,d.useState)([]),L=p().create({baseURL:"http://35.78.68.113:8072"});(0,d.useEffect)((()=>{I=[],L.get("projonline/allRateCards",{headers:{token:"Bearer "+JSON.parse(localStorage.getItem("user")).accessToken}}).then((t=>{t.data.filter((t=>t.rateCardSubcon._id===JSON.parse(localStorage.getItem("user")).company._id&&t.rateCardValidTo>=e.acceptedDate&&t.rateCardValidFrom<=e.acceptedDate)).forEach((e=>{e.rateCardItems.forEach((t=>{t.rateCardDiv=e.rateCardDiv,I.push(t)}))}))})).catch((e=>{console.log(e)}))}),[]);const F={Add:(0,d.forwardRef)(((e,t)=>(0,O.jsx)(u.Z,{...e,ref:t}))),Check:(0,d.forwardRef)(((e,t)=>(0,O.jsx)(Z.Z,{...e,ref:t}))),Clear:(0,d.forwardRef)(((e,t)=>(0,O.jsx)(b.Z,{...e,ref:t}))),Delete:(0,d.forwardRef)(((e,t)=>(0,O.jsx)(S.Z,{...e,ref:t}))),DetailPanel:(0,d.forwardRef)(((e,t)=>(0,O.jsx)(w.Z,{...e,ref:t}))),Edit:(0,d.forwardRef)(((e,t)=>(0,O.jsx)(v.Z,{...e,ref:t}))),Export:(0,d.forwardRef)(((e,t)=>(0,O.jsx)(D.Z,{...e,ref:t}))),Filter:(0,d.forwardRef)(((e,t)=>(0,O.jsx)(k.Z,{...e,ref:t}))),FirstPage:(0,d.forwardRef)(((e,t)=>(0,O.jsx)(C.Z,{...e,ref:t}))),LastPage:(0,d.forwardRef)(((e,t)=>(0,O.jsx)(y.Z,{...e,ref:t}))),NextPage:(0,d.forwardRef)(((e,t)=>(0,O.jsx)(w.Z,{...e,ref:t}))),PreviousPage:(0,d.forwardRef)(((e,t)=>(0,O.jsx)(g.Z,{...e,ref:t}))),ResetSearch:(0,d.forwardRef)(((e,t)=>(0,O.jsx)(b.Z,{...e,ref:t}))),Search:(0,d.forwardRef)(((e,t)=>(0,O.jsx)(T.Z,{...e,ref:t}))),SortArrow:(0,d.forwardRef)(((e,t)=>(0,O.jsx)(j.Z,{...e,ref:t}))),ThirdStateCheck:(0,d.forwardRef)(((e,t)=>(0,O.jsx)(R.Z,{...e,ref:t}))),ViewColumn:(0,d.forwardRef)(((e,t)=>(0,O.jsx)(P.Z,{...e,ref:t})))},E=()=>{Array.isArray(A)&&A.length&&e.callBk(t.filter((e=>A.includes(e)))),N(!1);const i=I.map((e=>({...e,tableData:{checked:!1}})));a(i),B([])},_=()=>{N(!1);const e=I.map((e=>({...e,tableData:{checked:!1}})));a(e),B([])};return(0,d.useEffect)((()=>{a("all"===c?I:I.filter((e=>e.rateCard===c)))}),[c]),(0,O.jsx)(i.Z,{open:W,fullWidth:!0,maxWidth:"lg",children:(0,O.jsx)(r.Z,{children:(0,O.jsx)(h(),{title:"BOQ Line Items",columns:[{title:"ERP Code",field:"erpCode",cellStyle:{width:100,minWidth:100,maxWidth:100,height:1}},{title:"Rate Card Div",field:"rateCardDiv",cellStyle:{width:150,minWidth:150,maxWidth:150,height:1}},{title:"Item Discreption",field:"itemDiscreption",cellStyle:{width:400,minWidth:400,maxWidth:400,height:1}},{title:"UoM",field:"itemUom",cellStyle:{width:150,minWidth:150,maxWidth:150,height:1}},{title:"Unit Rate",field:"itemRate",type:"currency",currencySetting:{currencyCode:"LKR"},cellStyle:{width:200,minWidth:200,maxWidth:200,height:1}}],data:t,icons:F,onSelectionChange:e=>B(e),options:{exportButton:!0,pageSizeOptions:[5,10,20],paginationType:"stepped",showTextRowsSelected:!1,actionsColumnIndex:-1,filtering:!0,selection:!0,tableLayout:"auto",selectionProps:{},rowStyle:{backgroundColor:"#EEE"},headerStyle:{backgroundColor:"#01579b",color:"#FFF"}},actions:[{icon:()=>(0,O.jsxs)(f.Z,{labelId:"demo-simple-select-label",id:"demo-simple-select",value:c,onChange:e=>x(e.target.value),style:{width:100},children:[(0,O.jsx)(m.Z,{value:"all",children:(0,O.jsx)("em",{children:"All"})}),(0,O.jsx)(m.Z,{value:"TX",children:"TX"}),(0,O.jsx)(m.Z,{value:"IBS",children:"IBS"}),(0,O.jsx)(m.Z,{value:"BTS",children:"BTS"})]}),tooltip:"Select Rate Card",isFreeAction:!0}],components:{Pagination:e=>(0,O.jsxs)("div",{children:[(0,O.jsxs)(o.Z,{container:!0,style:{pading:15,background:"#f5f5f5"},children:[(0,O.jsx)(o.Z,{sm:11,align:"right",item:!0,children:(0,O.jsx)(s.Z,{children:(0,O.jsx)(l.Z,{variant:"contained",type:"submit",color:"primary",onClick:E,children:"Submit"})})}),(0,O.jsx)(o.Z,{sm:1,align:"center",item:!0,children:(0,O.jsx)(s.Z,{children:(0,O.jsx)(l.Z,{variant:"contained",color:"default",onClick:_,children:"Close"})})})]}),(0,O.jsx)(n.Z,{...e})]})}})})})}}}]);
//# sourceMappingURL=1295.b894147b.chunk.js.map