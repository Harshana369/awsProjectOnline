"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[385],{90385:function(e,a,t){t.r(a);var n=t(4942),s=t(74165),i=t(15861),r=t(29439),o=t(1413),l=t(72791),d=t(79271),c=t(74569),u=t.n(c),p=t(89743),h=t(62591),f=t(16149),v=t(2677),x=t(43360),m=t(34575),j=t(19658),Z=t(64554),b=t(39157),g=t(13239),k=t(29818),C=t(80184),S=l.forwardRef((function(e,a){return(0,C.jsx)(j.Z,(0,o.Z)({elevation:6,ref:a,variant:"filled"},e))}));a.default=(0,d.EN)((function(e){var a=(0,l.useState)([]),t=(0,r.Z)(a,2),d=t[0],c=t[1],j=(0,l.useState)([]),y=(0,r.Z)(j,2),O=(y[0],y[1]),T=(0,l.useState)([]),I=(0,r.Z)(T,2),q=(I[0],I[1]),_=(0,l.useState)([]),M=(0,r.Z)(_,2),R=M[0],P=M[1],A=(0,l.useState)([]),N=(0,r.Z)(A,2),w=N[0],L=N[1],B=(0,l.useState)([]),G=(0,r.Z)(B,2),D=G[0],E=G[1],V=(0,l.useState)([]),U=(0,r.Z)(V,2),F=U[0],z=U[1],J=(0,l.useState)(""),Q=(0,r.Z)(J,2),H=Q[0],Y=Q[1],K=(0,l.useState)(""),W=(0,r.Z)(K,2),X=W[0],$=W[1],ee=u().create({baseURL:"http://localhost:80/"}),ae=(0,l.useState)({}),te=(0,r.Z)(ae,2),ne=te[0],se=te[1],ie=(0,l.useState)([]),re=(0,r.Z)(ie,2),oe=re[0],le=re[1],de=(0,l.useState)({}),ce=(0,r.Z)(de,2),ue=ce[0],pe=ce[1],he=(0,l.useState)(!1),fe=(0,r.Z)(he,2),ve=fe[0],xe=fe[1],me=(0,l.useState)(!1),je=(0,r.Z)(me,2),Ze=je[0],be=je[1],ge=(0,l.useState)(""),ke=(0,r.Z)(ge,2),Ce=ke[0],Se=ke[1],ye=function(){var e=ne.boqApprovalRequirment,a={};return e&&""!==e&&"Choose..."!==e||(a.boqApprovalRequirment="Choose a Boq status"),a},Oe=function(){var a=(0,i.Z)((0,s.Z)().mark((function a(t){var n,i,r;return(0,s.Z)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(n=ye(),!(Object.keys(n).length>0)){a.next=5;break}pe(n),a.next=20;break;case 5:return t.preventDefault(),be(!0),i=ne.boqApprovalRequirment,a.prev=8,a.next=11,ee.put("projonline/boqProjectRequirement/".concat(i),oe,{headers:{token:"Bearer "+JSON.parse(localStorage.getItem("user")).accessToken}});case 11:r=a.sent,setTimeout((function(){Y(r.data.msg),$(r.data.variant),xe(!0)}),1e3),setTimeout((function(){e.history.push({pathname:"/modifyTask"})}),2e3),a.next=20;break;case 16:a.prev=16,a.t0=a.catch(8),Y("Error updating BOQ"),console.error("Error updating BOQ:",a.t0);case 20:case"end":return a.stop()}}),a,null,[[8,16]])})));return function(e){return a.apply(this,arguments)}}(),Te=function(e,a){se((0,o.Z)((0,o.Z)({},ne),{},(0,n.Z)({},e,a))),ue[e]&&pe((0,o.Z)((0,o.Z)({},ue),{},(0,n.Z)({},e,null)))};(0,l.useEffect)((function(){ee.get("projonline/users",{headers:{token:"Bearer "+JSON.parse(localStorage.getItem("user")).accessToken}}).then((function(a){le(e.location.data),O(a.data.users.filter((function(e){return"Mobitel"!==e.company.companyName}))),c(a.data.users.filter((function(e){return!0===e.userCanAssignForTask}))),q(a.data.companys.filter((function(e){return"Mobitel"!==e.companyName}))),P(a.data.users),L([{_id:"",name:"Choose..."}]),E([{_id:"",name:"Choose..."}]),z([{_id:"",name:"Choose..."}])})).catch((function(e){console.log(e)}))}),[]);var Ie=function(a){var t=function(){var e=ne.taskStatus,a={};return e&&""!==e&&"Choose..."!==e||(a.taskStatus="Choose a task status"),a}();Object.keys(t).length>0?pe(t):(a.preventDefault(),be(!0),ee.post("projonline/update",{tasks:oe,taskObject:{taskStatus:ne.taskStatus},taskHistory:{taskStatus:"Status Changed",comment:"Task Status Changed to > "+ne.taskStatus}},{headers:{token:"Bearer "+JSON.parse(localStorage.getItem("user")).accessToken}}).then((function(a){Y(a.data.msg),$(a.data.variant),xe(!0),setTimeout((function(){be(!1),xe(!1),le([]),e.history.push({pathname:"/modifyTask"})}),1e3)})).catch((function(e){console.log(e)})))},qe=function(e,a){"clickaway"!==a&&xe(!1)};function _e(e,a){return e&&e.approvalPath&&e.approvalPath.length>0?e.approvalPath.map((function(e,a){var t=e.assignedOfficer;return(0,C.jsx)("div",{children:(0,C.jsxs)("div",{children:[e.approvalLevel," : ",t.name]})},a)})):"No approval path found"}for(var Me=0;Me<oe.length;Me++)"Task accepted"!==oe[Me].taskStatus&&"Task commenced"!==oe[Me].taskStatus&&(document.getElementById("formChangeTaskStatus").disabled=!0,document.getElementById("btnChangeTaskStatus").disabled=!0);for(Me=0;Me<oe.length;Me++)"Task handed over"!==oe[Me].taskStatus&&"Subcon allocated"!==oe[Me].taskStatus&&"Task accepted"!==oe[Me].taskStatus&&"Task completed"!==oe[Me].taskStatus&&"Task commenced"!==oe[Me].taskStatus&&"Task rejected"!==oe[Me].taskStatus&&(document.getElementById("formChangeBoqApprovalRequirment").disabled=!0,document.getElementById("btnChangeBoqApprovalRequirement").disabled=!0);return(0,C.jsxs)("div",{children:[(0,C.jsxs)("div",{className:"content-wrapper",children:[(0,C.jsx)("div",{className:"content-header",children:(0,C.jsx)("section",{className:"content-header",children:(0,C.jsx)("div",{className:"container-fluid",children:(0,C.jsx)("div",{className:"row mb-2",children:(0,C.jsx)("div",{className:"col-sm-6",children:(0,C.jsx)("h1",{children:"Modify Task"})})})})})}),(0,C.jsx)("section",{className:"content",children:(0,C.jsx)("div",{className:"container-fluid",children:(0,C.jsxs)("form",{children:[(0,C.jsx)("div",{children:(0,C.jsx)(p.Z,{children:(0,C.jsxs)(h.Z,{striped:!0,bordered:!0,hover:!0,size:"sm",children:[(0,C.jsx)("thead",{children:(0,C.jsxs)("tr",{children:[(0,C.jsx)("th",{children:"Task Ref"}),(0,C.jsx)("th",{children:"Site ID"}),(0,C.jsx)("th",{children:"Site Name"}),(0,C.jsx)("th",{children:"Assigned Mobitel Officer"}),(0,C.jsx)("th",{children:"Task Status"}),(0,C.jsx)("th",{children:"BOQ"}),(0,C.jsx)("th",{children:"Approval Path"})]})}),(0,C.jsx)("tbody",{children:oe.map((function(e,a){return(0,C.jsxs)("tr",{children:[(0,C.jsx)("td",{children:e.taskRef}),(0,C.jsx)("td",{children:e.siteID}),(0,C.jsx)("td",{children:e.siteName}),(0,C.jsx)("td",{children:e.assignedMobitelOfficer.name}),(0,C.jsx)("td",{children:e.taskStatus}),(0,C.jsx)("td",{children:!0===e.boqprojectrequirement?"Required":!1===e.boqprojectrequirement?"Not Required":"Required"}),(0,C.jsx)("td",{children:_e(e)})]},a)}))})]})})}),(0,C.jsxs)("div",{style:{border:"1px solid #ccc",padding:"10px"},children:[(0,C.jsxs)(p.Z,{children:[(0,C.jsxs)(f.Z.Group,{as:v.Z,children:[(0,C.jsx)(f.Z.Label,{children:"Change Task Status"}),(0,C.jsxs)(f.Z.Control,{id:"formChangeTaskStatus",onChange:function(e){Te("taskStatus",e.target.value),console.log("Selected Task Status:",e.target.value)},value:ne.taskStatus,as:"select",defaultValue:"item.taskStatus",isInvalid:!!ue.taskStatus,children:[(0,C.jsx)("option",{children:"Choose..."}),(0,C.jsx)("option",{children:"Task handed over"})]}),(0,C.jsx)(f.Z.Control.Feedback,{type:"invalid",children:ue.taskStatus})]}),(0,C.jsxs)(f.Z.Group,{as:v.Z,children:[(0,C.jsx)(f.Z.Label,{children:"Update Task Status"}),(0,C.jsx)("br",{}),(0,C.jsx)(x.Z,{onClick:function(e){return Ie(e)},variant:"primary",type:"button",style:{width:"130px",height:"30px"},id:"btnChangeTaskStatus",children:"Update Task Status"})]}),(0,C.jsx)(f.Z.Group,{as:v.Z})]}),(0,C.jsx)(p.Z,{children:(0,C.jsx)(f.Z,{children:(0,C.jsx)(f.Z.Group,{as:v.Z,children:(0,C.jsx)(f.Z.Label,{style:{fontSize:11},children:'** You can\'t change the status once the task already submitted as "Task completed"'})})})})]}),(0,C.jsx)(p.Z,{children:(0,C.jsx)(f.Z,{children:(0,C.jsx)("br",{})})}),(0,C.jsxs)("div",{style:{border:"1px solid #ccc",padding:"10px"},children:[(0,C.jsxs)(p.Z,{children:[(0,C.jsxs)(f.Z.Group,{as:v.Z,children:[(0,C.jsx)(f.Z.Label,{children:"Re-Assign To"}),(0,C.jsxs)(f.Z.Control,{onChange:function(e){var a=e.target.selectedOptions[0],t=(a.value,Ce=a.getAttribute("name"),a.getAttribute("name"));Se(t),"Choose..."===e.target.value&&(Te("assignedMobitelOfficer",e.target.value),L([{_id:"",name:"Choose..."}]),E([{_id:"",name:"Choose..."}]),z([{_id:"",name:"Choose..."}]));for(var n=0;n<R.length;n++)if(R[n]._id===e.target.value)switch(R[n].approvalPath.length){case 0:L([{_id:"",name:"Choose..."}]),E([{_id:"",name:"Choose..."}]),z([{_id:"",name:"Choose..."}]),se((0,o.Z)((0,o.Z)({},ne),{},{verificationOneId:"",verificationTwoId:"",approvalId:"",assignedMobitelOfficer:e.target.value,approvalType:"Default"})),ue.assignedMobitelOfficer&&pe((0,o.Z)((0,o.Z)({},ue),{},{assignedMobitelOfficer:null}));break;case 1:L([{_id:R[n].approvalPath[0]._id,name:R[n].approvalPath[0].name}]),Te("verificationOneId",R[n].approvalPath[0]._id),E([{_id:"",name:"Choose..."}]),z([{_id:"",name:"Choose..."}]),se((0,o.Z)((0,o.Z)({},ne),{},{verificationOneId:R[n].approvalPath[0]._id,verificationTwoId:"",approvalId:"",assignedMobitelOfficer:e.target.value,approvalType:"Default"})),ue.assignedMobitelOfficer&&pe((0,o.Z)((0,o.Z)({},ue),{},{assignedMobitelOfficer:null}));break;case 2:L([{_id:R[n].approvalPath[0]._id,name:R[n].approvalPath[0].name}]),E([{_id:"",name:"Choose...."}]),z([{_id:R[n].approvalPath[1]._id,name:R[n].approvalPath[1].name}]),se((0,o.Z)((0,o.Z)({},ne),{},{verificationOneId:R[n].approvalPath[0]._id,verificationTwoId:"",approvalId:R[n].approvalPath[1]._id,assignedMobitelOfficer:e.target.value,approvalType:"Default"})),ue.assignedMobitelOfficer&&pe((0,o.Z)((0,o.Z)({},ue),{},{assignedMobitelOfficer:null}));break;case 3:L([{_id:R[n].approvalPath[0]._id,name:R[n].approvalPath[0].name}]),E([{_id:R[n].approvalPath[1]._id,name:R[n].approvalPath[1].name}]),z([{_id:R[n].approvalPath[2]._id,name:R[n].approvalPath[2].name}]),se((0,o.Z)((0,o.Z)({},ne),{},{verificationOneId:R[n].approvalPath[0]._id,verificationTwoId:R[n].approvalPath[1]._id,approvalId:R[n].approvalPath[2]._id,assignedMobitelOfficer:e.target.value,approvalType:"Default"})),ue.assignedMobitelOfficer&&pe((0,o.Z)((0,o.Z)({},ue),{},{assignedMobitelOfficer:null}))}},as:"select",value:ne.assignedMobitelOfficer,defaultValue:"Choose...",isInvalid:!!ue.assignedMobitelOfficer,children:[(0,C.jsx)("option",{children:"Choose..."}),d.map((function(e){return(0,C.jsx)("option",{value:e._id,name:e.name,children:e.name})}))]}),(0,C.jsx)(f.Z.Control.Feedback,{type:"invalid",children:ue.assignedMobitelOfficer})]}),(0,C.jsxs)(f.Z.Group,{as:v.Z,children:[(0,C.jsx)(f.Z.Label,{children:"Re-Assign"}),(0,C.jsx)("br",{}),(0,C.jsx)(x.Z,{onClick:function(a){a.preventDefault();var t=function(){var e=ne.assignedMobitelOfficer,a={};return e&&""!==e&&"Choose..."!==e||(a.assignedMobitelOfficer="Choose a Mobitel Officer!"),a}();if(Object.keys(t).length>0)pe(t);else{var n=[{approvalLevel:"Verification Level 0",assignedOfficer:ne.assignedMobitelOfficer},{approvalLevel:"Verification Level 1",assignedOfficer:ne.verificationOneId},{approvalLevel:"Verification Level 2",assignedOfficer:ne.verificationTwoId},{approvalLevel:"Final approval",assignedOfficer:ne.approvalId}].filter((function(e){return""!=e.assignedOfficer})),s={assignedMobitelOfficer:ne.assignedMobitelOfficer,approvalPath:n};be(!0),ee.post("projonline/update",{tasks:oe,taskObject:s,taskHistory:{taskStatus:"Mobitel Officer Re-Assigned",comment:"Task Re-Assigned to > "+Ce}},{headers:{token:"Bearer "+JSON.parse(localStorage.getItem("user")).accessToken}}).then((function(a){setTimeout((function(){Y(a.data.msg),$(a.data.variant),xe(!0)}),2e3),setTimeout((function(){be(!1),xe(!1),L([{_id:"",name:"Choose..."}]),E([{_id:"",name:"Choose..."}]),z([{_id:"",name:"Choose..."}]),le([]),se({verificationOneId:"",verificationTwoId:"",approvalId:"",assignedMobitelOfficer:"",approvalType:"Default"}),e.history.push({pathname:"/modifyTask"})}),1e3)})).catch((function(e){console.log(e)}))}},variant:"primary",type:"button",style:{width:"130px",height:"30px"},children:"Re-Assign"})]}),(0,C.jsx)(f.Z.Group,{as:v.Z})]}),(0,C.jsx)(p.Z,{}),(0,C.jsxs)(p.Z,{children:[(0,C.jsxs)(f.Z.Group,{as:v.Z,children:[(0,C.jsx)(f.Z.Label,{children:"Verification by (Level 1)"}),(0,C.jsx)(f.Z.Control,{as:"select",onChange:function(e){return Te("verificationOneId",e.target.value)},value:ne.verificationOneId,defaultValue:"Choose...",isInvalid:!!ue.verificationOneId,disabled:!0,children:w.map((function(e){return(0,C.jsx)("option",{value:e._id,children:e.name})}))}),(0,C.jsx)(f.Z.Control.Feedback,{type:"invalid",children:ue.verificationOneId})]}),(0,C.jsxs)(f.Z.Group,{as:v.Z,children:[(0,C.jsx)(f.Z.Label,{children:"Verification by (Level 2)"}),(0,C.jsx)(f.Z.Control,{as:"select",onChange:function(e){return Te("verificationTwoId",e.target.value)},value:ne.verificationTwoId,defaultValue:"Choose...",disabled:!0,children:D.map((function(e){return(0,C.jsx)("option",{value:e._id,children:e.name})}))})]}),(0,C.jsxs)(f.Z.Group,{as:v.Z,children:[(0,C.jsx)(f.Z.Label,{children:"Approval by"}),(0,C.jsx)(f.Z.Control,{as:"select",onChange:function(e){return Te("approvalId",e.target.value)},value:ne.approvalId,defaultValue:"Choose...",isInvalid:!!ue.approvalId,disabled:!0,children:F.map((function(e){return(0,C.jsx)("option",{value:e._id,children:e.name})}))}),(0,C.jsx)(f.Z.Control.Feedback,{type:"invalid",children:ue.approvalId})]})]}),(0,C.jsx)(p.Z,{children:(0,C.jsx)(f.Z,{children:(0,C.jsx)(f.Z.Group,{as:v.Z,children:(0,C.jsx)(f.Z.Label,{style:{fontSize:11},children:"** If you need to change current approval path, Go to (My Account>Add/Update User or Company>Select relevant Mobitel Officer to be assigned) and Update the approval path before re-assign the task."})})})})]}),(0,C.jsx)(p.Z,{children:(0,C.jsx)(f.Z,{children:(0,C.jsx)("br",{})})}),(0,C.jsx)(p.Z,{children:(0,C.jsx)(f.Z,{children:(0,C.jsx)("br",{})})}),(0,C.jsxs)("div",{style:{border:"1px solid #ccc",padding:"10px"},children:[(0,C.jsxs)(p.Z,{children:[(0,C.jsxs)(f.Z.Group,{as:v.Z,children:[(0,C.jsx)(f.Z.Label,{children:"BOQ Approval Requirement"}),(0,C.jsxs)(f.Z.Control,{id:"formChangeBoqApprovalRequirment",onChange:function(e){Te("boqApprovalRequirment",e.target.value),console.log("Selected boqApprovalRequirment:",e.target.value)},value:ne.boqApprovalRequirment,as:"select",defaultValue:"item.boqApprovalRequirment",isInvalid:!!ue.boqApprovalRequirment,children:[(0,C.jsx)("option",{children:"Choose..."}),(0,C.jsx)("option",{value:!0,children:"Required"}),(0,C.jsx)("option",{value:!1,children:"Not Required"})]}),(0,C.jsx)(f.Z.Control.Feedback,{type:"invalid",children:ue.boqApprovalRequirment})]}),(0,C.jsxs)(f.Z.Group,{as:v.Z,children:[(0,C.jsx)(f.Z.Label,{children:"Update"}),(0,C.jsx)("br",{}),(0,C.jsx)(x.Z,{onClick:function(e){return Oe(e)},variant:"primary",type:"button",style:{width:"130px",height:"30px"},id:"btnChangeBoqApprovalRequirement",children:"Update"})]}),(0,C.jsx)(f.Z.Group,{as:v.Z})]}),(0,C.jsx)(p.Z,{})]}),(0,C.jsx)(p.Z,{children:(0,C.jsx)(f.Z,{children:(0,C.jsx)("br",{})})})]})})})]}),(0,C.jsx)(m.Z,{open:ve,autoHideDuration:6e3,onClose:qe,anchorOrigin:{vertical:"top",horizontal:"center"},children:(0,C.jsx)(S,{onClose:qe,severity:X,sx:{width:"100%"},children:H})}),(0,C.jsx)(k.Z,{open:Ze,onClose:qe,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:(0,C.jsx)(b.Z,{children:(0,C.jsx)(Z.Z,{sx:{display:"flex"},children:(0,C.jsx)(g.Z,{})})})})]})}))},62591:function(e,a,t){var n=t(87462),s=t(63366),i=t(81694),r=t.n(i),o=t(72791),l=t(10162),d=["bsPrefix","className","striped","bordered","borderless","hover","size","variant","responsive"],c=o.forwardRef((function(e,a){var t=e.bsPrefix,i=e.className,c=e.striped,u=e.bordered,p=e.borderless,h=e.hover,f=e.size,v=e.variant,x=e.responsive,m=(0,s.Z)(e,d),j=(0,l.vE)(t,"table"),Z=r()(i,j,v&&j+"-"+v,f&&j+"-"+f,c&&j+"-striped",u&&j+"-bordered",p&&j+"-borderless",h&&j+"-hover"),b=o.createElement("table",(0,n.Z)({},m,{className:Z,ref:a}));if(x){var g=j+"-responsive";return"string"===typeof x&&(g=g+"-"+x),o.createElement("div",{className:g},b)}return b}));a.Z=c}}]);
//# sourceMappingURL=385.67b8524b.chunk.js.map