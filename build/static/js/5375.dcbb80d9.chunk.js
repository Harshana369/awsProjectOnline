(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[5375],{61896:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>C});var t=s(72791),o=s(79271),n=s(74569),i=s.n(n),l=s(16149),r=s(89743),d=s(2677),c=s(43360),m=s(34575),h=s(19658),p=s(58484),u=s.n(p),x=s(29818),j=s(64554),k=s(39157),b=s(13239),Z=s(80184);const v=t.forwardRef((function(e,a){return(0,Z.jsx)(h.Z,{elevation:6,ref:a,variant:"filled",...e})}));const C=(0,o.EN)((function(e){let[a,s]=(0,t.useState)([]),[o,n]=(0,t.useState)([]),[h,p]=(0,t.useState)(""),[C,f]=(0,t.useState)("");const g=i().create({baseURL:"http://35.78.68.113:8072/projonline"});let[S,y]=(0,t.useState)({}),[w,D]=(0,t.useState)({}),[N,T]=(0,t.useState)(!1),[I,O]=(0,t.useState)(!1),M=(e,a)=>{y({...S,[e]:a}),w[e]&&D({...w,[e]:null})};(0,t.useEffect)((()=>{s([{name:e.location.data.row.assignedMobitelOfficer.name}]),n([{companyName:e.location.data.row.assignedSubcon.companyName}]),y({taskRef:e.location.data.row.taskRef,siteID:e.location.data.row.siteID,siteName:e.location.data.row.siteName,plannedTaskStartDate:e.location.data.row.plannedTaskStartDate.split("T")[0],actualTaskStartDate:e.location.data.row.taskHistory.find((e=>"Task commenced"===e.taskStatus)).performedDate.split("T")[0],targetTaskComDate:e.location.data.row.targetTaskComDate.split("T")[0],taskAssignedDiv:e.location.data.row.taskAssignedDiv,assignedMobitelOfficer:e.location.data.row.assignedMobitelOfficer.name,workScope:e.location.data.row.workScope,assignedSubcon:e.location.data.row.assignedSubcon.companyName,taskassignedSubconOfficer:e.location.data.row.taskassignedSubconOfficer,taskassignedMobileNo:e.location.data.row.taskassignedMobileNo})}),[]);const G=(e,a)=>{"clickaway"!==a&&T(!1)};return(0,Z.jsxs)("div",{children:[(0,Z.jsxs)("div",{className:"content-wrapper",children:[(0,Z.jsx)("div",{className:"content-header",children:(0,Z.jsx)("section",{className:"content-header",children:(0,Z.jsx)("div",{className:"container-fluid",children:(0,Z.jsx)("div",{children:(0,Z.jsxs)("h1",{children:["Complete Task ID: ",S.taskRef," "]})})})})}),(0,Z.jsx)("section",{className:"content",children:(0,Z.jsx)("div",{className:"container-fluid",children:(0,Z.jsxs)(l.Z,{children:[(0,Z.jsxs)(r.Z,{children:[(0,Z.jsxs)(l.Z.Group,{as:d.Z,children:[(0,Z.jsx)(l.Z.Label,{children:"Site ID"}),(0,Z.jsx)(l.Z.Control,{disabled:!0,value:S.siteID,className:"col-md-9",type:"text",placeholder:"Enter site ID",isInvalid:!!w.siteID}),(0,Z.jsx)(l.Z.Control.Feedback,{type:"invalid",children:w.siteID})]}),(0,Z.jsxs)(l.Z.Group,{as:d.Z,children:[(0,Z.jsx)(l.Z.Label,{children:"Site Name"}),(0,Z.jsx)(l.Z.Control,{disabled:!0,value:S.siteName,type:"text",placeholder:"Enter site Name",isInvalid:!!w.siteName}),(0,Z.jsx)(l.Z.Control.Feedback,{type:"invalid",children:w.siteName})]}),(0,Z.jsx)(l.Z.Group,{as:d.Z,controlId:""})]}),(0,Z.jsxs)(r.Z,{className:"mb-3",children:[(0,Z.jsxs)(l.Z.Group,{as:d.Z,children:[(0,Z.jsx)(l.Z.Label,{children:"Planned Work Commencement Date"}),(0,Z.jsx)(l.Z.Control,{disabled:!0,value:S.plannedTaskStartDate,className:"col-md-9",type:"date",isInvalid:!!w.plannedTaskStartDate}),(0,Z.jsx)(l.Z.Control.Feedback,{type:"invalid",children:w.plannedTaskStartDate})]}),(0,Z.jsxs)(l.Z.Group,{as:d.Z,children:[(0,Z.jsx)(l.Z.Label,{children:"Actual Work Commencement Date"}),(0,Z.jsx)(l.Z.Control,{disabled:!0,value:S.actualTaskStartDate,className:"col-md-9",type:"date",isInvalid:!!w.actualTaskStartDate}),(0,Z.jsx)(l.Z.Control.Feedback,{type:"invalid",children:w.actualTaskStartDate})]}),(0,Z.jsxs)(l.Z.Group,{as:d.Z,children:[(0,Z.jsx)(l.Z.Label,{children:"Planned Work Completion Date"}),(0,Z.jsx)(l.Z.Control,{disabled:!0,value:S.targetTaskComDate,className:"col-md-9",type:"date",isInvalid:!!w.targetTaskComDate}),(0,Z.jsx)(l.Z.Control.Feedback,{type:"invalid",children:w.targetTaskComDate})]})]}),(0,Z.jsxs)(r.Z,{children:[(0,Z.jsxs)(l.Z.Group,{as:d.Z,children:[(0,Z.jsx)(l.Z.Label,{children:"Task Assigned Division"}),(0,Z.jsxs)(l.Z.Control,{disabled:!0,value:S.taskAssignedDiv,as:"select",defaultValue:"Choose...",isInvalid:!!w.taskAssignedDiv,children:[(0,Z.jsx)("option",{children:"Choose..."}),(0,Z.jsx)("option",{children:"Project_Radio"}),(0,Z.jsx)("option",{children:"Project_Core"}),(0,Z.jsx)("option",{children:"Project_TX"}),(0,Z.jsx)("option",{children:"Project_IBS"}),(0,Z.jsx)("option",{children:"Project_WiFi"})]}),(0,Z.jsx)(l.Z.Control.Feedback,{type:"invalid",children:w.taskAssignedDiv})]}),(0,Z.jsxs)(l.Z.Group,{as:d.Z,children:[(0,Z.jsx)(l.Z.Label,{children:"Assigned Mobitel Officer"}),(0,Z.jsxs)(l.Z.Control,{disabled:!0,as:"select",value:S.assignedMobitelOfficer,defaultValue:"Choose...",isInvalid:!!w.assignedMobitelOfficer,children:[(0,Z.jsx)("option",{children:"Choose..."}),a.map((e=>(0,Z.jsx)("option",{value:e._id,children:e.name})))]}),(0,Z.jsx)(l.Z.Control.Feedback,{type:"invalid",children:w.assignedMobitelOfficer})]}),(0,Z.jsx)(l.Z.Group,{as:d.Z})]}),(0,Z.jsx)(r.Z,{children:(0,Z.jsxs)(l.Z.Group,{as:d.Z,children:[(0,Z.jsx)(l.Z.Label,{children:"High level work scope"}),(0,Z.jsx)(l.Z.Control,{disabled:!0,value:S.workScope,as:"textarea",rows:2,placeholder:"",isInvalid:!!w.workScope}),(0,Z.jsx)(l.Z.Control.Feedback,{type:"invalid",children:w.workScope})]})}),(0,Z.jsxs)(r.Z,{className:"mb-3",children:[(0,Z.jsxs)(l.Z.Group,{as:d.Z,children:[(0,Z.jsx)(l.Z.Label,{children:"Assigned subcontractor"}),(0,Z.jsxs)(l.Z.Control,{disabled:!0,value:S.assignedSubcon,as:"select",defaultValue:"Choose...",isInvalid:!!w.assignedSubcon,children:[(0,Z.jsx)("option",{children:"Choose..."}),o.map((e=>(0,Z.jsx)("option",{value:e._id,children:e.companyName})))]}),(0,Z.jsx)(l.Z.Control.Feedback,{type:"invalid",children:w.assignedSubcon})]}),(0,Z.jsxs)(l.Z.Group,{as:d.Z,children:[(0,Z.jsx)(l.Z.Label,{children:"Handover Details"}),(0,Z.jsx)("br",{}),(0,Z.jsx)(c.Z,{onClick:a=>{var s=u().utils.book_new(),t=[];t.push(e.location.data.row.properties),t.unshift(e.location.data.row.headerProperties);var o=u().utils.aoa_to_sheet(t);u().utils.book_append_sheet(s,o,"HO Details"),u().writeFile(s,e.location.data.row.siteID+"_Handover details.xlsx")},variant:"primary",type:"button",children:"Click to Download"})]}),(0,Z.jsx)(l.Z.Group,{as:d.Z})]}),(0,Z.jsxs)(r.Z,{children:[(0,Z.jsxs)(l.Z.Group,{as:d.Z,children:[(0,Z.jsx)(l.Z.Label,{children:"Task Assigned Subcon Officer"}),(0,Z.jsx)(l.Z.Control,{disabled:!0,onChange:e=>M("taskassignedSubconOfficer",e.target.value),value:S.taskassignedSubconOfficer,className:"col-md-9",type:"text",placeholder:"Enter name",isInvalid:!!w.taskassignedSubconOfficer}),(0,Z.jsx)(l.Z.Control.Feedback,{type:"invalid",children:w.taskassignedSubconOfficer})]}),(0,Z.jsxs)(l.Z.Group,{as:d.Z,children:[(0,Z.jsx)(l.Z.Label,{children:"Mobile Number"}),(0,Z.jsx)(l.Z.Control,{disabled:!0,onChange:e=>M("taskassignedMobileNo",e.target.value),className:"col-md-9",value:S.taskassignedMobileNo,type:"number",placeholder:"Enter mobile number",isInvalid:!!w.taskassignedMobileNo}),(0,Z.jsx)(l.Z.Control.Feedback,{type:"invalid",children:w.taskassignedMobileNo})]}),(0,Z.jsx)(l.Z.Group,{as:d.Z})]}),(0,Z.jsx)(r.Z,{children:(0,Z.jsxs)(l.Z.Group,{as:d.Z,children:[(0,Z.jsx)(l.Z.Label,{children:"Comments"}),(0,Z.jsx)(l.Z.Control,{onChange:e=>M("taskCommencedComment",e.target.value),as:"textarea",rows:2,value:S.taskCommencedComment,placeholder:"Enter your comments",isInvalid:!!w.taskCommencedComment}),(0,Z.jsx)(l.Z.Control.Feedback,{type:"invalid",children:w.taskCommencedComment})]})}),(0,Z.jsx)(c.Z,{variant:"primary",onClick:a=>{a.preventDefault();const s=(()=>{const{taskCommencedComment:e}=S,a={};return e&&""!==e||(a.taskCommencedComment="cannot be blank!"),a})();if(Object.keys(s).length>0)D(s);else{const a={taskStatus:"Task completed"};g.put("projonline/update/"+e.location.data.row._id,{taskObject:a,taskHistory:{taskStatus:"Task completed",comment:S.taskCommencedComment}},{headers:{token:"Bearer "+JSON.parse(localStorage.getItem("user")).accessToken}}).then((a=>{O(!0),(async e=>{const a={username:"smsdigisvc_sci",password:"Sci@#25",from:"Mobitel-PMS",to:"0"+e,text:"Task ID: "+S.taskRef+" task is completed now.",mesageType:0},s={method:"POST",body:JSON.stringify(a),mode:"no-cors"};await fetch("https://msmsenterpriseapi.mobitel.lk/EnterpriseSMSV3/esmsproxyURL.php",s)})(S.taskassignedMobileNo),setTimeout((()=>{f(a.data.alart),p(a.data.severity),T(!0)}),2e3),setTimeout((()=>{O(!1),T(!1),e.history.push({pathname:"/completeNewTasks"})}),5e3)})).catch((e=>{console.log(e)}))}},children:"Task complete"})]})})})]}),(0,Z.jsx)(m.Z,{open:N,autoHideDuration:6e3,onClose:G,anchorOrigin:{vertical:"top",horizontal:"center"},children:(0,Z.jsx)(v,{onClose:G,severity:h,sx:{width:"100%"},children:C})}),(0,Z.jsx)(x.Z,{open:I,onClose:G,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:(0,Z.jsx)(k.Z,{children:(0,Z.jsx)(j.Z,{sx:{display:"flex"},children:(0,Z.jsx)(b.Z,{})})})})]})}))},55382:()=>{},72095:()=>{},61219:()=>{}}]);
//# sourceMappingURL=5375.dcbb80d9.chunk.js.map