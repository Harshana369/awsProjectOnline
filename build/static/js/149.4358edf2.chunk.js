(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[149],{44072:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>Q});var i=a(72791),r=a(79271),o=a(74569),s=a.n(o),l=a(16149),d=a(89743),n=a(2677),c=a(34575),h=a(19658),f=a(61889),m=a(20890),x=a(15617),p=a.n(x),u=a(82159),g=(a(53063),a(3986)),j=a(29818),w=a(64554),S=a(39157),Z=a(13239),y=(a(58484),a(76897)),b=a(31052),R=a.n(b),C=a(5936),v=a(3395),D=a(872),k=a(31009),P=a(38996),T=a(5130),W=a(82271),N=a(41286),O=a(91903),I=a(12715),L=a(10111),A=a(35585),B=a(16346),K=a(5403),E=a(97911),F=a(80184);const _=i.forwardRef((function(e,t){return(0,F.jsx)(h.Z,{elevation:6,ref:t,variant:"filled",...e})}));const Q=(0,r.EN)((function(e){let[t,a]=(0,i.useState)([]),[o,h]=(0,i.useState)([]);const[x,b]=(0,i.useState)(!1),[Q,U]=(0,i.useState)([]),[M,V]=(0,i.useState)(),[q,G]=(0,i.useState)([]);let[H,z]=(0,i.useState)(""),[X,J]=(0,i.useState)("");s().create({baseURL:"http://35.78.68.113:8072/"});let[Y,$]=(0,i.useState)({}),[ee,te]=(0,i.useState)({}),[ae,ie]=(0,i.useState)(!1),[re,oe]=(0,i.useState)(!1);const[se,le]=(0,i.useState)(0),[de,ne]=(0,i.useState)(0),ce={Add:(0,i.forwardRef)(((e,t)=>(0,F.jsx)(C.Z,{...e,ref:t}))),Check:(0,i.forwardRef)(((e,t)=>(0,F.jsx)(D.Z,{...e,ref:t}))),Clear:(0,i.forwardRef)(((e,t)=>(0,F.jsx)(T.Z,{...e,ref:t}))),Delete:(0,i.forwardRef)(((e,t)=>(0,F.jsx)(W.Z,{...e,ref:t}))),DetailPanel:(0,i.forwardRef)(((e,t)=>(0,F.jsx)(P.Z,{...e,ref:t}))),Edit:(0,i.forwardRef)(((e,t)=>(0,F.jsx)(N.Z,{...e,ref:t}))),Export:(0,i.forwardRef)(((e,t)=>(0,F.jsx)(B.Z,{...e,ref:t}))),Filter:(0,i.forwardRef)(((e,t)=>(0,F.jsx)(O.Z,{...e,ref:t}))),FirstPage:(0,i.forwardRef)(((e,t)=>(0,F.jsx)(I.Z,{...e,ref:t}))),LastPage:(0,i.forwardRef)(((e,t)=>(0,F.jsx)(L.Z,{...e,ref:t}))),NextPage:(0,i.forwardRef)(((e,t)=>(0,F.jsx)(P.Z,{...e,ref:t}))),PreviousPage:(0,i.forwardRef)(((e,t)=>(0,F.jsx)(k.Z,{...e,ref:t}))),ResetSearch:(0,i.forwardRef)(((e,t)=>(0,F.jsx)(T.Z,{...e,ref:t}))),Search:(0,i.forwardRef)(((e,t)=>(0,F.jsx)(K.Z,{...e,ref:t}))),SortArrow:(0,i.forwardRef)(((e,t)=>(0,F.jsx)(v.Z,{...e,ref:t}))),ThirdStateCheck:(0,i.forwardRef)(((e,t)=>(0,F.jsx)(A.Z,{...e,ref:t}))),ViewColumn:(0,i.forwardRef)(((e,t)=>(0,F.jsx)(E.Z,{...e,ref:t})))},he=[{dataKey:"taskStatus",header:"Status"},{dataKey:"performedDate",header:"Performed Date"},{dataKey:"performedBy",header:"Performed by"},{dataKey:"comment",header:"Comment"}],fe=[{header:"ERP Code",dataKey:"erpCode"},{header:"Rate Card Div",dataKey:"rateCardDiv"},{header:"Item Discreption",dataKey:"itemDiscreption"},{header:"UoM",dataKey:"itemUom"},{header:"Unit Rate",dataKey:"itemRate"},{header:"Quantity",dataKey:"itemQty"},{header:"Item Total",dataKey:"itemTotal"},{header:"Capex/Opex",dataKey:"capexopexLine"},{header:"Comment",dataKey:"itemComment"}],me=(0,r.k6)();(0,i.useEffect)((()=>{e.location.data?(a([{name:e.location.data.row.assignedMobitelOfficer.name}]),h([{companyName:e.location.data.row.assignedSubcon.companyName}]),$({taskRef:e.location.data.row.taskRef,siteID:e.location.data.row.siteID,siteName:e.location.data.row.siteName,actualTaskStartDate:e.location.data.row.taskHistory.find((e=>"Task commenced"===e.taskStatus)).performedDate.split("T")[0],actualTaskCompletedDate:e.location.data.row.taskHistory.find((e=>"Task completed"===e.taskStatus)).performedDate.split("T")[0],taskAssignedDiv:e.location.data.row.taskAssignedDiv,assignedMobitelOfficer:e.location.data.row.assignedMobitelOfficer.name,workScope:e.location.data.row.workScope,assignedSubcon:e.location.data.row.assignedSubcon.companyName,verificationOneId:e.location.data.row.approvalPath[0].name,verificationTwoId:e.location.data.row.approvalPath[1].name,approvalId:e.location.data.row.approvalPath[2].name}),U(e.location.data.row.boqs[e.location.data.row.boqs.length-1].boqData),V(e.location.data.row.boqs[e.location.data.row.boqs.length-1].totalCost),G(e.location.data.row.taskHistory.filter((e=>"BOQ Verified_0"===e.taskStatus||"BOQ Verified_1"===e.taskStatus||"BOQ Verified_2"===e.taskStatus||"BOQ Approved"===e.taskStatus||"BOQ submitted"===e.taskStatus||"BOQ Rejected"===e.taskStatus))),le(e.location.data.row.boqs[e.location.data.row.boqs.length-1].CapexPrAmount),ne(e.location.data.row.boqs[e.location.data.row.boqs.length-1].OpexPrAmount)):me.push("/completedTasks")}),[]);const xe=(e,t)=>{"clickaway"!==t&&ie(!1)};return(0,F.jsxs)("div",{children:[(0,F.jsxs)("div",{className:"content-wrapper",children:[(0,F.jsx)("div",{className:"content-header",children:(0,F.jsx)("section",{className:"content-header",children:(0,F.jsx)("div",{className:"container-fluid",children:(0,F.jsx)("div",{className:"row mb-2",children:(0,F.jsx)("div",{className:"col-sm-6",children:(0,F.jsxs)("h1",{children:["BOQ Task ID: ",Y.taskRef," "]})})})})})}),(0,F.jsx)("section",{className:"content",children:(0,F.jsxs)("div",{className:"container-fluid",children:[(0,F.jsxs)(l.Z,{children:[(0,F.jsxs)(d.Z,{children:[(0,F.jsxs)(l.Z.Group,{as:n.Z,children:[(0,F.jsx)(l.Z.Label,{children:"Site ID"}),(0,F.jsx)(l.Z.Control,{disabled:!0,value:Y.siteID,className:"col-md-9",type:"text",placeholder:"Enter site ID"})]}),(0,F.jsxs)(l.Z.Group,{as:n.Z,children:[(0,F.jsx)(l.Z.Label,{children:"Site Name"}),(0,F.jsx)(l.Z.Control,{disabled:!0,value:Y.siteName,type:"text",placeholder:"Enter site Name"})]}),(0,F.jsx)(l.Z.Group,{as:n.Z,controlId:""})]}),(0,F.jsxs)(d.Z,{children:[(0,F.jsxs)(l.Z.Group,{as:n.Z,children:[(0,F.jsx)(l.Z.Label,{children:"Task Assigned Division"}),(0,F.jsxs)(l.Z.Control,{disabled:!0,value:Y.taskAssignedDiv,as:"select",defaultValue:"Choose...",children:[(0,F.jsx)("option",{children:"Choose..."}),(0,F.jsx)("option",{children:"Project_Radio"}),(0,F.jsx)("option",{children:"Project_Core"}),(0,F.jsx)("option",{children:"Project_TX"}),(0,F.jsx)("option",{children:"Project_IBS"}),(0,F.jsx)("option",{children:"Project_WiFi"})]})]}),(0,F.jsxs)(l.Z.Group,{as:n.Z,children:[(0,F.jsx)(l.Z.Label,{children:"Assigned Mobitel Officer"}),(0,F.jsxs)(l.Z.Control,{disabled:!0,as:"select",value:Y.assignedMobitelOfficer,defaultValue:"Choose...",children:[(0,F.jsx)("option",{children:"Choose..."}),t.map((e=>(0,F.jsx)("option",{value:e._id,children:e.name})))]})]}),(0,F.jsxs)(l.Z.Group,{as:n.Z,children:[(0,F.jsx)(l.Z.Label,{children:"Assigned subcontractor"}),(0,F.jsxs)(l.Z.Control,{disabled:!0,value:Y.assignedSubcon,as:"select",defaultValue:"Choose...",children:[(0,F.jsx)("option",{children:"Choose..."}),o.map((e=>(0,F.jsx)("option",{value:e._id,children:e.companyName})))]})]})]})]}),(0,F.jsx)(p(),{title:"BOQ-"+Y.siteID+"_"+Y.taskRef,data:Q,columns:[{title:"ERP Code",field:"erpCode",filtering:!1,editable:!1,cellStyle:{width:100,minWidth:100,maxWidth:100,height:1}},{title:"Rate Card Div",field:"rateCardDiv",editable:!1,cellStyle:{width:100,minWidth:100,maxWidth:100,height:1}},{title:"Item Discreption",field:"itemDiscreption",filtering:!1,editable:!1,cellStyle:{width:300,minWidth:300,maxWidth:300,height:1}},{title:"UoM",field:"itemUom",editable:!1,cellStyle:{width:50,minWidth:50,maxWidth:50,height:1}},{title:"Unit Rate",field:"itemRate",editable:!1,filtering:!1,cellStyle:{width:100,minWidth:100,maxWidth:100,height:1}},{title:"Quantity",field:"itemQty",editable:!1,cellStyle:{width:50,minWidth:50,maxWidth:50,height:1}},{title:"Item Total",field:"itemTotal",type:"currency",currencySetting:{currencyCode:"LKR"},editable:!1,cellStyle:{width:100,minWidth:100,maxWidth:100,height:1}},{title:"Capex/Opex",field:"capexopexLine",cellStyle:{width:100,minWidth:100,maxWidth:100,height:1},editable:!1},{title:"Comment",field:"itemComment",editable:"onUpdate",cellStyle:{width:100,minWidth:100,maxWidth:100,height:1}}],icons:ce,editable:{onRowUpdate:(e,t)=>new Promise(((a,i)=>{const r=t.tableData.id,o=[...Q];e.itemTotal=e.itemRate*e.itemQty,o[r]=e,setTimeout((()=>{U(o),a()}),2e3)}))},options:{exportButton:!0,pageSizeOptions:[Q.length,5,10,20],paginationType:"stepped",showTextRowsSelected:!1,actionsColumnIndex:-1,filtering:!1,tableLayout:"auto",search:!1,rowStyle:{backgroundColor:"#EEE"},headerStyle:{backgroundColor:"#01579b",color:"#FFF"},exportPdf:(e,t)=>{const a=new y.jsPDF({orientation:"landscape"});R()(a,{head:[["Task ID : "+Y.taskRef]]}),R()(a,{theme:"grid",head:[["Site ID","Site Name","Assigned Mobitel Officer","Assigned Subcon","Capex Amount","Opex Amount","Total Value"]],body:[[Y.siteID,Y.siteName,Y.assignedMobitelOfficer,Y.assignedSubcon,se&&""!==se?se.toLocaleString("en-US",{style:"currency",currency:"LKR"}):"Not Defined",de&&""!==de?de.toLocaleString("en-US",{style:"currency",currency:"LKR"}):"Not Defined",M.toLocaleString("en-US",{style:"currency",currency:"LKR"})]]}),R()(a,{head:[["BOQ"]]}),R()(a,{theme:"grid",columnStyles:{itemRate:{halign:"right"},itemTotal:{halign:"right"}},columns:fe,body:t}),R()(a,{head:[["Approval Hirarchy"]]}),R()(a,{theme:"grid",columns:he,body:q.map((e=>({...e,performedBy:e.performedBy.name})))});const i=new Date;"".concat(i.getFullYear()).concat((i.getMonth()+1).toString().padStart(2,"0")).concat(i.getDate().toString().padStart(2,"0"));a.save("BOQ_".concat(Y.taskRef,"_","".concat((new Date).getFullYear()).concat(((new Date).getMonth()+1).toString().padStart(2,"0")).concat((new Date).getDate().toString().padStart(2,"0")),".pdf"))}},components:{Pagination:e=>(0,F.jsxs)(F.Fragment,{children:[(0,F.jsxs)(f.ZP,{container:!0,style:{pading:300,background:"#f5f5f5"},children:[(0,F.jsxs)(f.ZP,{sm:9,item:!0,children:[(0,F.jsx)(m.Z,{align:"right",variant:"subtitle1",children:"Capex Amount"}),(0,F.jsx)(m.Z,{align:"right",variant:"subtitle1",children:"Opex Amount"}),(0,F.jsx)(m.Z,{align:"right",fontWeight:"bold",variant:"subtitle1",children:"Total Amount"})]}),(0,F.jsxs)(f.ZP,{sm:3,align:"center",children:[(0,F.jsx)(m.Z,{align:"right",variant:"subtitle1",children:se?"LKR "+parseFloat(se):"LKR 0.00"}),(0,F.jsx)(m.Z,{align:"right",variant:"subtitle1",children:de?"LKR "+parseFloat(de):"LKR 0.00"}),(0,F.jsx)(m.Z,{align:"right",fontWeight:"bold",variant:"subtitle1",children:"LKR "+M})]})]}),(0,F.jsx)(u.Z,{...e})]})}}),(0,F.jsx)("br",{}),(0,F.jsx)(d.Z,{children:(0,F.jsxs)(l.Z.Group,{as:n.Z,children:[(0,F.jsx)(l.Z.Label,{children:"Approval History"}),(0,F.jsx)("div",{style:{height:250,width:"100%"},children:(0,F.jsx)(g._$r,{getRowId:e=>e._id,rows:q,columns:[{field:"taskStatus",headerName:"Status",width:250},{field:"performedDate",headerName:"Performed Date",width:200,valueGetter:e=>e.row.performedDate.split("T")[0]},{field:"performedBy",headerName:"Performed by",width:200,valueGetter:e=>e.row.performedBy.name},{field:"comment",headerName:"Comment",width:500}],pageSize:5,rowsPerPageOptions:[5],rowHeight:30,headerHeight:40})})]})})]})})]}),(0,F.jsx)(c.Z,{open:ae,autoHideDuration:6e3,onClose:xe,anchorOrigin:{vertical:"top",horizontal:"center"},children:(0,F.jsx)(_,{onClose:xe,severity:H,sx:{width:"100%"},children:X})}),(0,F.jsx)(j.Z,{open:re,onClose:xe,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:(0,F.jsx)(S.Z,{children:(0,F.jsx)(w.Z,{sx:{display:"flex"},children:(0,F.jsx)(Z.Z,{})})})})]})}))},53063:(e,t,a)=>{"use strict";a.d(t,{Z:()=>O});var i=a(83837),r=a(94026),o=a(1288),s=a(20269),l=a(26513),d=a(82159),n=a(72791),c=a(15617),h=a.n(c),f=a(63727),m=a(51859),x=a(74569),p=a.n(x),u=a(5936),g=a(3395),j=a(872),w=a(31009),S=a(38996),Z=a(5130),y=a(82271),b=a(41286),R=a(91903),C=a(12715),v=a(10111),D=a(35585),k=a(16346),P=a(5403),T=a(97911),W=a(80184);let N=[];function O(e){const[t,a]=(0,n.useState)(N),[c,x]=(0,n.useState)("all"),{openPopup:O,setOpenPopup:I}=e,[L,A]=(0,n.useState)([]),B=p().create({baseURL:"http://35.78.68.113:8072/"});(0,n.useEffect)((()=>{N=[],B.get("projonline/allRateCards",{headers:{token:"Bearer "+JSON.parse(localStorage.getItem("user")).accessToken}}).then((t=>{t.data.filter((t=>t.rateCardSubcon._id===JSON.parse(localStorage.getItem("user")).company._id&&t.rateCardValidTo>=e.acceptedDate&&t.rateCardValidFrom<=e.acceptedDate)).forEach((e=>{e.rateCardItems.forEach((t=>{t.rateCardDiv=e.rateCardDiv,N.push(t)}))}))})).catch((e=>{console.log(e)}))}),[]);const K={Add:(0,n.forwardRef)(((e,t)=>(0,W.jsx)(u.Z,{...e,ref:t}))),Check:(0,n.forwardRef)(((e,t)=>(0,W.jsx)(j.Z,{...e,ref:t}))),Clear:(0,n.forwardRef)(((e,t)=>(0,W.jsx)(Z.Z,{...e,ref:t}))),Delete:(0,n.forwardRef)(((e,t)=>(0,W.jsx)(y.Z,{...e,ref:t}))),DetailPanel:(0,n.forwardRef)(((e,t)=>(0,W.jsx)(S.Z,{...e,ref:t}))),Edit:(0,n.forwardRef)(((e,t)=>(0,W.jsx)(b.Z,{...e,ref:t}))),Export:(0,n.forwardRef)(((e,t)=>(0,W.jsx)(k.Z,{...e,ref:t}))),Filter:(0,n.forwardRef)(((e,t)=>(0,W.jsx)(R.Z,{...e,ref:t}))),FirstPage:(0,n.forwardRef)(((e,t)=>(0,W.jsx)(C.Z,{...e,ref:t}))),LastPage:(0,n.forwardRef)(((e,t)=>(0,W.jsx)(v.Z,{...e,ref:t}))),NextPage:(0,n.forwardRef)(((e,t)=>(0,W.jsx)(S.Z,{...e,ref:t}))),PreviousPage:(0,n.forwardRef)(((e,t)=>(0,W.jsx)(w.Z,{...e,ref:t}))),ResetSearch:(0,n.forwardRef)(((e,t)=>(0,W.jsx)(Z.Z,{...e,ref:t}))),Search:(0,n.forwardRef)(((e,t)=>(0,W.jsx)(P.Z,{...e,ref:t}))),SortArrow:(0,n.forwardRef)(((e,t)=>(0,W.jsx)(g.Z,{...e,ref:t}))),ThirdStateCheck:(0,n.forwardRef)(((e,t)=>(0,W.jsx)(D.Z,{...e,ref:t}))),ViewColumn:(0,n.forwardRef)(((e,t)=>(0,W.jsx)(T.Z,{...e,ref:t})))},E=()=>{Array.isArray(L)&&L.length&&e.callBk(t.filter((e=>L.includes(e)))),I(!1);const i=N.map((e=>({...e,tableData:{checked:!1}})));a(i),A([])},F=()=>{I(!1);const e=N.map((e=>({...e,tableData:{checked:!1}})));a(e),A([])};return(0,n.useEffect)((()=>{a("all"===c?N:N.filter((e=>e.rateCard===c)))}),[c]),(0,W.jsx)(i.Z,{open:O,fullWidth:!0,maxWidth:"lg",children:(0,W.jsx)(r.Z,{children:(0,W.jsx)(h(),{title:"BOQ Line Items",columns:[{title:"ERP Code",field:"erpCode",cellStyle:{width:100,minWidth:100,maxWidth:100,height:1}},{title:"Rate Card Div",field:"rateCardDiv",cellStyle:{width:150,minWidth:150,maxWidth:150,height:1}},{title:"Item Discreption",field:"itemDiscreption",cellStyle:{width:400,minWidth:400,maxWidth:400,height:1}},{title:"UoM",field:"itemUom",cellStyle:{width:150,minWidth:150,maxWidth:150,height:1}},{title:"Unit Rate",field:"itemRate",type:"currency",currencySetting:{currencyCode:"LKR"},cellStyle:{width:200,minWidth:200,maxWidth:200,height:1}}],data:t,icons:K,onSelectionChange:e=>A(e),options:{exportButton:!0,pageSizeOptions:[5,10,20],paginationType:"stepped",showTextRowsSelected:!1,actionsColumnIndex:-1,filtering:!0,selection:!0,tableLayout:"auto",selectionProps:{},rowStyle:{backgroundColor:"#EEE"},headerStyle:{backgroundColor:"#01579b",color:"#FFF"}},actions:[{icon:()=>(0,W.jsxs)(f.Z,{labelId:"demo-simple-select-label",id:"demo-simple-select",value:c,onChange:e=>x(e.target.value),style:{width:100},children:[(0,W.jsx)(m.Z,{value:"all",children:(0,W.jsx)("em",{children:"All"})}),(0,W.jsx)(m.Z,{value:"TX",children:"TX"}),(0,W.jsx)(m.Z,{value:"IBS",children:"IBS"}),(0,W.jsx)(m.Z,{value:"BTS",children:"BTS"})]}),tooltip:"Select Rate Card",isFreeAction:!0}],components:{Pagination:e=>(0,W.jsxs)("div",{children:[(0,W.jsxs)(o.Z,{container:!0,style:{pading:15,background:"#f5f5f5"},children:[(0,W.jsx)(o.Z,{sm:11,align:"right",item:!0,children:(0,W.jsx)(s.Z,{children:(0,W.jsx)(l.Z,{variant:"contained",type:"submit",color:"primary",onClick:E,children:"Submit"})})}),(0,W.jsx)(o.Z,{sm:1,align:"center",item:!0,children:(0,W.jsx)(s.Z,{children:(0,W.jsx)(l.Z,{variant:"contained",color:"default",onClick:F,children:"Close"})})})]}),(0,W.jsx)(d.Z,{...e})]})}})})})}},55382:()=>{},72095:()=>{},61219:()=>{}}]);
//# sourceMappingURL=149.4358edf2.chunk.js.map