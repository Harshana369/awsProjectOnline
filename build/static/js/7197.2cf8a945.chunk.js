"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[7197],{53063:(e,t,a)=>{a.d(t,{Z:()=>O});var i=a(83837),s=a(94026),o=a(1288),r=a(20269),l=a(26513),d=a(82159),n=a(72791),c=a(15617),h=a.n(c),f=a(63727),m=a(51859),x=a(74569),p=a.n(x),u=a(5936),j=a(3395),Z=a(872),w=a(31009),b=a(38996),g=a(5130),S=a(82271),k=a(41286),C=a(91903),y=a(12715),v=a(10111),R=a(35585),D=a(16346),T=a(5403),P=a(97911),N=a(80184);let I=[];function O(e){const[t,a]=(0,n.useState)(I),[c,x]=(0,n.useState)("all"),{openPopup:O,setOpenPopup:W}=e,[B,F]=(0,n.useState)([]),A=p().create({baseURL:"http://35.78.68.113:8072/"});(0,n.useEffect)((()=>{I=[],A.get("projonline/allRateCards",{headers:{token:"Bearer "+JSON.parse(localStorage.getItem("user")).accessToken}}).then((t=>{t.data.filter((t=>t.rateCardSubcon._id===JSON.parse(localStorage.getItem("user")).company._id&&t.rateCardValidTo>=e.acceptedDate&&t.rateCardValidFrom<=e.acceptedDate)).forEach((e=>{e.rateCardItems.forEach((t=>{t.rateCardDiv=e.rateCardDiv,I.push(t)}))}))})).catch((e=>{console.log(e)}))}),[]);const E={Add:(0,n.forwardRef)(((e,t)=>(0,N.jsx)(u.Z,{...e,ref:t}))),Check:(0,n.forwardRef)(((e,t)=>(0,N.jsx)(Z.Z,{...e,ref:t}))),Clear:(0,n.forwardRef)(((e,t)=>(0,N.jsx)(g.Z,{...e,ref:t}))),Delete:(0,n.forwardRef)(((e,t)=>(0,N.jsx)(S.Z,{...e,ref:t}))),DetailPanel:(0,n.forwardRef)(((e,t)=>(0,N.jsx)(b.Z,{...e,ref:t}))),Edit:(0,n.forwardRef)(((e,t)=>(0,N.jsx)(k.Z,{...e,ref:t}))),Export:(0,n.forwardRef)(((e,t)=>(0,N.jsx)(D.Z,{...e,ref:t}))),Filter:(0,n.forwardRef)(((e,t)=>(0,N.jsx)(C.Z,{...e,ref:t}))),FirstPage:(0,n.forwardRef)(((e,t)=>(0,N.jsx)(y.Z,{...e,ref:t}))),LastPage:(0,n.forwardRef)(((e,t)=>(0,N.jsx)(v.Z,{...e,ref:t}))),NextPage:(0,n.forwardRef)(((e,t)=>(0,N.jsx)(b.Z,{...e,ref:t}))),PreviousPage:(0,n.forwardRef)(((e,t)=>(0,N.jsx)(w.Z,{...e,ref:t}))),ResetSearch:(0,n.forwardRef)(((e,t)=>(0,N.jsx)(g.Z,{...e,ref:t}))),Search:(0,n.forwardRef)(((e,t)=>(0,N.jsx)(T.Z,{...e,ref:t}))),SortArrow:(0,n.forwardRef)(((e,t)=>(0,N.jsx)(j.Z,{...e,ref:t}))),ThirdStateCheck:(0,n.forwardRef)(((e,t)=>(0,N.jsx)(R.Z,{...e,ref:t}))),ViewColumn:(0,n.forwardRef)(((e,t)=>(0,N.jsx)(P.Z,{...e,ref:t})))},L=()=>{Array.isArray(B)&&B.length&&e.callBk(t.filter((e=>B.includes(e)))),W(!1);const i=I.map((e=>({...e,tableData:{checked:!1}})));a(i),F([])},Q=()=>{W(!1);const e=I.map((e=>({...e,tableData:{checked:!1}})));a(e),F([])};return(0,n.useEffect)((()=>{a("all"===c?I:I.filter((e=>e.rateCard===c)))}),[c]),(0,N.jsx)(i.Z,{open:O,fullWidth:!0,maxWidth:"lg",children:(0,N.jsx)(s.Z,{children:(0,N.jsx)(h(),{title:"BOQ Line Items",columns:[{title:"ERP Code",field:"erpCode",cellStyle:{width:100,minWidth:100,maxWidth:100,height:1}},{title:"Rate Card Div",field:"rateCardDiv",cellStyle:{width:150,minWidth:150,maxWidth:150,height:1}},{title:"Item Discreption",field:"itemDiscreption",cellStyle:{width:400,minWidth:400,maxWidth:400,height:1}},{title:"UoM",field:"itemUom",cellStyle:{width:150,minWidth:150,maxWidth:150,height:1}},{title:"Unit Rate",field:"itemRate",type:"currency",currencySetting:{currencyCode:"LKR"},cellStyle:{width:200,minWidth:200,maxWidth:200,height:1}}],data:t,icons:E,onSelectionChange:e=>F(e),options:{exportButton:!0,pageSizeOptions:[5,10,20],paginationType:"stepped",showTextRowsSelected:!1,actionsColumnIndex:-1,filtering:!0,selection:!0,tableLayout:"auto",selectionProps:{},rowStyle:{backgroundColor:"#EEE"},headerStyle:{backgroundColor:"#01579b",color:"#FFF"}},actions:[{icon:()=>(0,N.jsxs)(f.Z,{labelId:"demo-simple-select-label",id:"demo-simple-select",value:c,onChange:e=>x(e.target.value),style:{width:100},children:[(0,N.jsx)(m.Z,{value:"all",children:(0,N.jsx)("em",{children:"All"})}),(0,N.jsx)(m.Z,{value:"TX",children:"TX"}),(0,N.jsx)(m.Z,{value:"IBS",children:"IBS"}),(0,N.jsx)(m.Z,{value:"BTS",children:"BTS"})]}),tooltip:"Select Rate Card",isFreeAction:!0}],components:{Pagination:e=>(0,N.jsxs)("div",{children:[(0,N.jsxs)(o.Z,{container:!0,style:{pading:15,background:"#f5f5f5"},children:[(0,N.jsx)(o.Z,{sm:11,align:"right",item:!0,children:(0,N.jsx)(r.Z,{children:(0,N.jsx)(l.Z,{variant:"contained",type:"submit",color:"primary",onClick:L,children:"Submit"})})}),(0,N.jsx)(o.Z,{sm:1,align:"center",item:!0,children:(0,N.jsx)(r.Z,{children:(0,N.jsx)(l.Z,{variant:"contained",color:"default",onClick:Q,children:"Close"})})})]}),(0,N.jsx)(d.Z,{...e})]})}})})})}},57197:(e,t,a)=>{a.r(t),a.d(t,{default:()=>_});var i=a(72791),s=a(79271),o=a(74569),r=a.n(o),l=a(16149),d=a(89743),n=a(2677),c=a(43360),h=a(34575),f=a(19658),m=a(61889),x=a(20890),p=a(15617),u=a.n(p),j=a(82159),Z=a(53063),w=a(3986),b=a(29818),g=a(64554),S=a(39157),k=a(13239),C=a(5936),y=a(3395),v=a(872),R=a(31009),D=a(38996),T=a(5130),P=a(82271),N=a(41286),I=a(91903),O=a(12715),W=a(10111),B=a(35585),F=a(16346),A=a(5403),E=a(97911),L=a(80184);const Q=i.forwardRef((function(e,t){return(0,L.jsx)(f.Z,{elevation:6,ref:t,variant:"filled",...e})}));const _=(0,s.EN)((function(e){let[t,a]=(0,i.useState)([]),[s,o]=(0,i.useState)([]);const[f,p]=(0,i.useState)(!1),[_,G]=(0,i.useState)([]),[M,U]=(0,i.useState)(),[V,H]=(0,i.useState)([]);let[q,z]=(0,i.useState)(""),[J,K]=(0,i.useState)("");const X=r().create({baseURL:"http://35.78.68.113:8072/"});let[Y,$]=(0,i.useState)({}),[ee,te]=(0,i.useState)({}),[ae,ie]=(0,i.useState)(!1),[se,oe]=(0,i.useState)(!1);const re={Add:(0,i.forwardRef)(((e,t)=>(0,L.jsx)(C.Z,{...e,ref:t}))),Check:(0,i.forwardRef)(((e,t)=>(0,L.jsx)(v.Z,{...e,ref:t}))),Clear:(0,i.forwardRef)(((e,t)=>(0,L.jsx)(T.Z,{...e,ref:t}))),Delete:(0,i.forwardRef)(((e,t)=>(0,L.jsx)(P.Z,{...e,ref:t}))),DetailPanel:(0,i.forwardRef)(((e,t)=>(0,L.jsx)(D.Z,{...e,ref:t}))),Edit:(0,i.forwardRef)(((e,t)=>(0,L.jsx)(N.Z,{...e,ref:t}))),Export:(0,i.forwardRef)(((e,t)=>(0,L.jsx)(F.Z,{...e,ref:t}))),Filter:(0,i.forwardRef)(((e,t)=>(0,L.jsx)(I.Z,{...e,ref:t}))),FirstPage:(0,i.forwardRef)(((e,t)=>(0,L.jsx)(O.Z,{...e,ref:t}))),LastPage:(0,i.forwardRef)(((e,t)=>(0,L.jsx)(W.Z,{...e,ref:t}))),NextPage:(0,i.forwardRef)(((e,t)=>(0,L.jsx)(D.Z,{...e,ref:t}))),PreviousPage:(0,i.forwardRef)(((e,t)=>(0,L.jsx)(R.Z,{...e,ref:t}))),ResetSearch:(0,i.forwardRef)(((e,t)=>(0,L.jsx)(T.Z,{...e,ref:t}))),Search:(0,i.forwardRef)(((e,t)=>(0,L.jsx)(A.Z,{...e,ref:t}))),SortArrow:(0,i.forwardRef)(((e,t)=>(0,L.jsx)(y.Z,{...e,ref:t}))),ThirdStateCheck:(0,i.forwardRef)(((e,t)=>(0,L.jsx)(B.Z,{...e,ref:t}))),ViewColumn:(0,i.forwardRef)(((e,t)=>(0,L.jsx)(E.Z,{...e,ref:t})))};function le(){var e=0;for(let t=0;t<_.length;t++)e+=_[t].itemRate*_[t].itemQty;return U(e),e}(0,i.useEffect)((()=>{a([{name:e.location.data.row.assignedMobitelOfficer.name}]),o([{companyName:e.location.data.row.assignedSubcon.companyName}]),$({taskRef:e.location.data.row.taskRef,siteID:e.location.data.row.siteID,siteName:e.location.data.row.siteName,actualTaskStartDate:e.location.data.row.taskHistory.find((e=>"Task commenced"===e.taskStatus)).performedDate.split("T")[0],actualTaskCompletedDate:e.location.data.row.taskHistory.find((e=>"Task completed"===e.taskStatus)).performedDate.split("T")[0],taskAssignedDiv:e.location.data.row.taskAssignedDiv,assignedMobitelOfficer:e.location.data.row.assignedMobitelOfficer.name,workScope:e.location.data.row.workScope,assignedSubcon:e.location.data.row.assignedSubcon.companyName}),H(e.location.data.row.taskHistory.filter((e=>"BOQ Verified_0"===e.taskStatus||"BOQ Verified_1"===e.taskStatus||"BOQ Verified_2"===e.taskStatus||"BOQ Rejected"===e.taskStatus||"BOQ submitted"===e.taskStatus))),"BOQ Rejected"===e.location.data.row.taskStatus&&(G(e.location.data.row.boqs[e.location.data.row.boqs.length-1].boqData),U(e.location.data.row.boqs[e.location.data.row.boqs.length-1].totalCost))}),[]);const de=(e,t)=>{"clickaway"!==t&&ie(!1)};return(0,L.jsxs)("div",{children:[(0,L.jsxs)("div",{className:"content-wrapper",children:[(0,L.jsx)("div",{className:"content-header",children:(0,L.jsx)("section",{className:"content-header",children:(0,L.jsx)("div",{className:"container-fluid",children:(0,L.jsx)("div",{className:"row mb-2",children:(0,L.jsx)("div",{className:"col-sm-6",children:(0,L.jsxs)("h1",{children:["Sumbit BOQ Task ID: ",Y.taskRef," "]})})})})})}),(0,L.jsxs)("section",{className:"content",children:[(0,L.jsxs)("div",{className:"container-fluid",children:[(0,L.jsxs)(l.Z,{children:[(0,L.jsxs)(d.Z,{children:[(0,L.jsxs)(l.Z.Group,{as:n.Z,children:[(0,L.jsx)(l.Z.Label,{children:"Site ID"}),(0,L.jsx)(l.Z.Control,{disabled:!0,value:Y.siteID,className:"col-md-9",type:"text",placeholder:"Enter site ID",isInvalid:!!ee.siteID}),(0,L.jsx)(l.Z.Control.Feedback,{type:"invalid",children:ee.siteID})]}),(0,L.jsxs)(l.Z.Group,{as:n.Z,children:[(0,L.jsx)(l.Z.Label,{children:"Site Name"}),(0,L.jsx)(l.Z.Control,{disabled:!0,value:Y.siteName,type:"text",placeholder:"Enter site Name",isInvalid:!!ee.siteName}),(0,L.jsx)(l.Z.Control.Feedback,{type:"invalid",children:ee.siteName})]}),(0,L.jsx)(l.Z.Group,{as:n.Z,controlId:""})]}),(0,L.jsxs)(d.Z,{className:"mb-3",children:[(0,L.jsxs)(l.Z.Group,{as:n.Z,children:[(0,L.jsx)(l.Z.Label,{children:"Actual Work Commencement Date"}),(0,L.jsx)(l.Z.Control,{disabled:!0,value:Y.actualTaskStartDate,className:"col-md-9",type:"date",isInvalid:!!ee.actualTaskStartDate}),(0,L.jsx)(l.Z.Control.Feedback,{type:"invalid",children:ee.actualTaskStartDate})]}),(0,L.jsxs)(l.Z.Group,{as:n.Z,children:[(0,L.jsx)(l.Z.Label,{children:"Actual Work Completed Date"}),(0,L.jsx)(l.Z.Control,{disabled:!0,value:Y.actualTaskCompletedDate,className:"col-md-9",type:"date",isInvalid:!!ee.actualTaskCompletedDate}),(0,L.jsx)(l.Z.Control.Feedback,{type:"invalid",children:ee.actualTaskCompletedDate})]}),(0,L.jsx)(l.Z.Group,{as:n.Z})]}),(0,L.jsxs)(d.Z,{children:[(0,L.jsxs)(l.Z.Group,{as:n.Z,children:[(0,L.jsx)(l.Z.Label,{children:"Task Assigned Division"}),(0,L.jsxs)(l.Z.Control,{disabled:!0,value:Y.taskAssignedDiv,as:"select",defaultValue:"Choose...",isInvalid:!!ee.taskAssignedDiv,children:[(0,L.jsx)("option",{children:"Choose..."}),(0,L.jsx)("option",{children:"Project_Radio"}),(0,L.jsx)("option",{children:"Project_Core"}),(0,L.jsx)("option",{children:"Project_TX"}),(0,L.jsx)("option",{children:"Project_IBS"}),(0,L.jsx)("option",{children:"Project_WiFi"})]}),(0,L.jsx)(l.Z.Control.Feedback,{type:"invalid",children:ee.taskAssignedDiv})]}),(0,L.jsxs)(l.Z.Group,{as:n.Z,children:[(0,L.jsx)(l.Z.Label,{children:"Assigned Mobitel Officer"}),(0,L.jsxs)(l.Z.Control,{disabled:!0,as:"select",value:Y.assignedMobitelOfficer,defaultValue:"Choose...",isInvalid:!!ee.assignedMobitelOfficer,children:[(0,L.jsx)("option",{children:"Choose..."}),t.map((e=>(0,L.jsx)("option",{value:e._id,children:e.name})))]}),(0,L.jsx)(l.Z.Control.Feedback,{type:"invalid",children:ee.assignedMobitelOfficer})]}),(0,L.jsxs)(l.Z.Group,{as:n.Z,children:[(0,L.jsx)(l.Z.Label,{children:"Assigned subcontractor"}),(0,L.jsxs)(l.Z.Control,{disabled:!0,value:Y.assignedSubcon,as:"select",defaultValue:"Choose...",isInvalid:!!ee.assignedSubcon,children:[(0,L.jsx)("option",{children:"Choose..."}),s.map((e=>(0,L.jsx)("option",{value:e._id,children:e.companyName})))]}),(0,L.jsx)(l.Z.Control.Feedback,{type:"invalid",children:ee.assignedSubcon})]})]}),(0,L.jsx)(d.Z,{children:(0,L.jsxs)(l.Z.Group,{as:n.Z,children:[(0,L.jsx)(l.Z.Label,{children:"High level work scope"}),(0,L.jsx)(l.Z.Control,{disabled:!0,value:Y.workScope,as:"textarea",rows:2,placeholder:"",isInvalid:!!ee.workScope}),(0,L.jsx)(l.Z.Control.Feedback,{type:"invalid",children:ee.workScope})]})})]}),(0,L.jsx)(u(),{title:"New BOQ Submission-"+Y.siteID+"_"+Y.taskRef,data:_,columns:[{title:"ERP Code",field:"erpCode",filtering:!1,editable:!1,cellStyle:{width:100,minWidth:100,maxWidth:100,height:1}},{title:"Rate Card Div",field:"rateCardDiv",editable:!1,cellStyle:{width:100,minWidth:100,maxWidth:100,height:1}},{title:"Item Discreption",field:"itemDiscreption",filtering:!1,editable:!1,cellStyle:{width:350,minWidth:350,maxWidth:350,height:1}},{title:"UoM",field:"itemUom",editable:!1,cellStyle:{width:50,minWidth:50,maxWidth:50,height:1}},{title:"Unit Rate",field:"itemRate",editable:!1,filtering:!1,cellStyle:{width:100,minWidth:100,maxWidth:100,height:1}},{title:"Quantity",field:"itemQty",cellStyle:{width:50,minWidth:50,maxWidth:50,height:1}},{title:"Item Total",field:"itemTotal",type:"currency",currencySetting:{currencyCode:"LKR"},editable:!1,cellStyle:{width:100,minWidth:100,maxWidth:100,height:1}},{title:"Comment",field:"itemComment",editable:"onUpdate",cellStyle:{width:100,minWidth:100,maxWidth:100,height:1}}],icons:re,editable:{onRowDelete:e=>new Promise(((t,a)=>{const i=e.tableData.id,s=[..._];s.splice(i,1),setTimeout((()=>{G(s),t()}),2e3)})),onRowUpdate:(e,t)=>new Promise(((a,i)=>{const s=t.tableData.id,o=[..._];e.itemTotal=e.itemRate*e.itemQty,o[s]=e,setTimeout((()=>{G(o),a()}),2e3)}))},options:{exportButton:!0,pageSizeOptions:[_.length,5,10,20],paginationType:"stepped",showTextRowsSelected:!1,actionsColumnIndex:-1,filtering:!1,tableLayout:"auto",rowStyle:{backgroundColor:"#EEE"},headerStyle:{backgroundColor:"#01579b",color:"#FFF"}},components:{Pagination:e=>(0,L.jsxs)(L.Fragment,{children:[(0,L.jsxs)(m.ZP,{container:!0,style:{pading:300,background:"#f5f5f5"},children:[(0,L.jsx)(m.ZP,{sm:9,item:!0,children:(0,L.jsx)(x.Z,{align:"right",variant:"subtitle1",fontWeight:"bold",children:"Total"})}),(0,L.jsx)(m.ZP,{sm:3,align:"right",fontWeight:"bold",children:"LKR "+le().toFixed(2)})]}),(0,L.jsx)(j.Z,{...e})]})},actions:[{icon:()=>(0,L.jsx)(c.Z,{variant:"contained",children:"Add"}),tooltip:"Add Line Item",onClick:()=>p(!0),isFreeAction:!0}]}),(0,L.jsx)("br",{}),(0,L.jsx)(d.Z,{children:(0,L.jsxs)(l.Z.Group,{as:n.Z,children:[(0,L.jsx)(l.Z.Label,{children:"Approval History"}),(0,L.jsx)("div",{style:{height:250,width:"100%"},children:(0,L.jsx)(w._$r,{getRowId:e=>e._id,rows:V,columns:[{field:"taskStatus",headerName:"Status",width:250},{field:"performedDate",headerName:"Performed Date",width:200,valueGetter:e=>e.row.performedDate.split("T")[0]},{field:"performedBy",headerName:"Performed by",width:200,valueGetter:e=>e.row.performedBy.name},{field:"comment",headerName:"Comment",width:500}],pageSize:5,rowsPerPageOptions:[5],rowHeight:30,headerHeight:40})})]})}),(0,L.jsx)("br",{}),(0,L.jsx)(c.Z,{variant:"primary",onClick:t=>{t.preventDefault();const a=(()=>{const{taskCommencedComment:e}=Y;return{}})();if(Object.keys(a).length>0)te(a);else{const t={taskStatus:"BOQ submitted"};X.put("projonline/update/"+e.location.data.row._id,{totalCost:M,boqData:_,taskObject:t,taskHistory:{taskStatus:"BOQ submitted",comment:Y.boqSubmittedComment}},{headers:{token:"Bearer "+JSON.parse(localStorage.getItem("user")).accessToken}}).then((t=>{(async e=>{const t={username:"smsdigisvc_sci",password:"Sci@#25",from:"Mobitel-PMS",to:"0"+e,text:"You have new BOQ to review. Please login to https://projectonline.mobitel.lk/",mesageType:0},a={method:"POST",body:JSON.stringify(t),mode:"no-cors"};await fetch("https://msmsenterpriseapi.mobitel.lk/EnterpriseSMSV3/esmsproxyURL.php",a)})(e.location.data.row.assignedMobitelOfficer.mobileNo),oe(!0),setTimeout((()=>{K(t.data.alart),z(t.data.severity),ie(!0)}),2e3),setTimeout((()=>{oe(!1),ie(!1),e.history.push({pathname:"/submitBoqTasks"})}),5e3)})).catch((e=>{console.log(e)}))}},children:"Submit BOQ"}),(0,L.jsx)("br",{})]}),(0,L.jsx)("br",{})]})]}),(0,L.jsx)(Z.Z,{openPopup:f,setOpenPopup:p,acceptedDate:e.location.data?e.location.data.row.taskHistory.find((e=>"Task accepted"===e.taskStatus)).performedDate:null,callBk:function(e){var t=[..._];e.map((e=>{const a={erpCode:e.erpCode,rateCardDiv:e.rateCardDiv,itemDiscreption:e.itemDiscreption,itemRate:e.itemRate.toFixed(2),itemUom:e.itemUom,itemQty:1,area:"Colombo",itemTotal:e.itemRate.toFixed(2)};t.push(a)})),G(t)}}),(0,L.jsx)(h.Z,{open:ae,autoHideDuration:6e3,onClose:de,anchorOrigin:{vertical:"top",horizontal:"center"},children:(0,L.jsx)(Q,{onClose:de,severity:q,sx:{width:"100%"},children:J})}),(0,L.jsx)(b.Z,{open:se,onClose:de,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:(0,L.jsx)(S.Z,{children:(0,L.jsx)(g.Z,{sx:{display:"flex"},children:(0,L.jsx)(k.Z,{})})})})]})}))}}]);
//# sourceMappingURL=7197.2cf8a945.chunk.js.map