(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[3338],{64681:function(e,t,r){"use strict";r.r(t);var n=r(4942),a=r(29439),s=r(1413),o=r(72791),i=r(79271),c=r(74569),l=r.n(c),d=r(3986),u=(r(2468),r(43360)),h=r(47022),f=r(89743),p=r(2677),j=r(39474),m=r(16149),g=r(34575),x=r(19658),Z=r(58484),v=r.n(Z),k=r(29818),S=r(64554),b=r(39157),N=r(13239),C=r(80184),y=o.forwardRef((function(e,t){return(0,C.jsx)(x.Z,(0,s.Z)({elevation:6,ref:t,variant:"filled"},e))})),P=["csv","xls","xlsx"];t.default=(0,i.EN)((function(){var e=(0,o.useState)([]),t=(0,a.Z)(e,2),r=t[0],i=t[1],c=(0,o.useState)([]),x=(0,a.Z)(c,2),Z=x[0],I=x[1],w=(0,o.useState)([]),H=(0,a.Z)(w,2),R=H[0],O=H[1],D=(0,o.useState)([]),T=(0,a.Z)(D,2),_=T[0],E=T[1],B=(0,o.useState)(!1),q=(0,a.Z)(B,2),G=q[0],L=q[1],A=(0,o.useState)(""),J=(0,a.Z)(A,2),F=J[0],M=J[1],z=(0,o.useState)(""),U=(0,a.Z)(z,2),W=U[0],V=U[1],$=(0,o.useState)(""),K=(0,a.Z)($,2),Q=K[0],X=K[1],Y=(0,o.useState)(""),ee=(0,a.Z)(Y,2),te=ee[0],re=ee[1],ne=(0,o.useState)(""),ae=(0,a.Z)(ne,2),se=ae[0],oe=ae[1],ie=(0,o.useState)(""),ce=(0,a.Z)(ie,2),le=ce[0],de=ce[1],ue=(0,o.useState)({}),he=(0,a.Z)(ue,2),fe=he[0],pe=he[1],je=(0,o.useState)([]),me=(0,a.Z)(je,2),ge=me[0],xe=me[1],Ze=(0,o.useState)([]),ve=(0,a.Z)(Ze,2),ke=(ve[0],ve[1]),Se=(0,o.useState)([]),be=(0,a.Z)(Se,2),Ne=be[0],Ce=be[1],ye=(0,o.useState)([]),Pe=(0,a.Z)(ye,2),Ie=Pe[0],we=Pe[1],He=(0,o.useState)(!1),Re=(0,a.Z)(He,2),Oe=Re[0],De=Re[1],Te=(0,o.useState)([]),_e=(0,a.Z)(Te,2),Ee=_e[0],Be=_e[1],qe=(0,o.useState)(),Ge=(0,a.Z)(qe,2),Le=Ge[0],Ae=Ge[1],Je=(0,o.useState)(),Fe=(0,a.Z)(Je,2),Me=Fe[0],ze=Fe[1],Ue=(0,o.useState)(),We=(0,a.Z)(Ue,2),Ve=We[0],$e=We[1],Ke=function(e,t){O((0,s.Z)((0,s.Z)({},R),{},(0,n.Z)({},t,e.target.value)))},Qe=(0,o.useState)(!1),Xe=(0,a.Z)(Qe,2),Ye=Xe[0],et=Xe[1],tt=(0,o.useState)(!1),rt=(0,a.Z)(tt,2),nt=rt[0],at=rt[1],st=(0,o.useRef)(),ot=function(){return et(!1)},it=function(){we([]),xe([]),at(!1)},ct=l().create({baseURL:"http://ec2-65-2-5-82.ap-south-1.compute.amazonaws.com/"});(0,o.useEffect)((function(){lt(),De(!0),dt(),ct.get("projonline/project",{headers:{token:"Bearer "+JSON.parse(localStorage.getItem("user")).accessToken}}).then((function(e){ke(e.data.projTemplates)})).catch((function(e){console.log(e)}))}),[]),(0,o.useEffect)((function(){ut()}),[Le]);var lt=function(){ct.get("projonline/mobitelusers",{headers:{token:"Bearer "+JSON.parse(localStorage.getItem("user")).accessToken}}).then((function(e){var t=e.data.map((function(e){return{name:e.name,_id:e._id}}));Be(t)})).catch((function(e){console.log(e)}))},dt=function(){ct.get("projonline/gettasks",{headers:{token:"Bearer "+JSON.parse(localStorage.getItem("user")).accessToken}}).then((function(e){var t=e.data.tasks.filter((function(e){if("Withdraw"!=e.taskStatus)return e}));i(t),De(!1)})).catch((function(e){console.log(e)}))},ut=function(){var e=null;Ee.forEach((function(t){t._id===Le&&(e=t.name)})),$e(e)},ht=function(){var e={};return Q&&""!==Q||(e.comment="cannot be blank!"),e};function ft(e,t){return Array.isArray(e)&&Array.isArray(t)&&e.length===t.length&&e.every((function(e,r){return e===t[r]}))}var pt=function(e,t){"clickaway"!==t&&L(!1)},jt=function(e,t){var r=[];return t.forEach((function(t,n){var a={};a.id=n,t.forEach((function(t,r){a[e[r]]=t})),r.push(a)})),r},mt=function(e){var t=e.name.split("."),r=t[t.length-1];return P.includes(r)},gt=[{field:"taskRef",headerName:"TaskID",width:250},{field:"SiteID",headerName:"SiteID",width:150,valueGetter:function(e){return e.row.properties[1]}},{field:"Site Name",headerName:"Site Name",width:175,valueGetter:function(e){return e.row.properties[2]}},{field:"project",headerName:"Project",width:175},{field:"subProject",headerName:"Sub Project",width:175},{field:"Change the Handover",width:250,align:"center",renderCell:function(e){return(0,C.jsx)(u.Z,{variant:"primary",style:{width:100},onClick:function(){!function(e){var t=null;Ee.forEach((function(r){r._id===e&&(t=r.name)})),ze(t)}(e.row.assignedProjectManager),function(e){I(e);for(var t=e.taskHistory.length-2;t>=0;t--)if("Hold requested"==e.taskHistory[t+1].taskStatus){de(e.taskHistory[t].taskStatus);break}O(e.properties),E(e.headerProperties),oe(e.taskStatus),X(""),et(!0)}(e.row)},children:"Edit"})}}];return(0,C.jsxs)("div",{children:[(0,C.jsxs)("div",{className:"content-wrapper",children:[(0,C.jsx)("div",{className:"content-header",children:(0,C.jsx)("section",{className:"content-header",children:(0,C.jsx)("div",{className:"container-fluid",children:(0,C.jsx)("div",{children:(0,C.jsx)("div",{children:(0,C.jsx)(h.Z,{children:(0,C.jsxs)(f.Z,{children:[(0,C.jsx)(p.Z,{xs:4,children:(0,C.jsx)("h1",{children:"Request Handover Changes"})}),(0,C.jsx)(p.Z,{xs:2}),(0,C.jsx)(p.Z,{children:(0,C.jsx)("div",{className:"vr"})}),(0,C.jsx)(p.Z,{children:(0,C.jsx)("div",{className:"vr"})}),(0,C.jsx)(p.Z,{children:(0,C.jsx)(u.Z,{variant:"primary",type:"button",onClick:function(){return at(!0)},children:"Handover Bulk Changes"})})]})})})})})})}),(0,C.jsx)("div",{style:{height:610,width:"100%"},children:(0,C.jsx)(d._$r,{getRowId:function(e){return e._id},rows:r,columns:gt,pageSize:15,rowsPerPageOptions:[15],rowHeight:30,headerHeight:40,components:{Toolbar:d.npt}})})]}),(0,C.jsxs)(j.Z,{show:nt,onHide:it,animation:!1,dialogClassName:"bulk-modal-size",children:[(0,C.jsx)(j.Z.Header,{closeButton:!0,children:(0,C.jsx)(j.Z.Title,{children:"Edit Handover"})}),(0,C.jsx)(j.Z.Body,{children:(0,C.jsxs)(m.Z,{children:[(0,C.jsx)(f.Z,{className:"mb-3",children:(0,C.jsxs)(m.Z.Group,{as:p.Z,children:[(0,C.jsx)(m.Z.Label,{children:"Upload edited task handover"}),(0,C.jsx)(m.Z.Control,{onChange:function(e){var t=e.target.files[0];pe((0,s.Z)((0,s.Z)({},fe),{},{file:null}));var n=new FileReader;n.onload=function(e){var t=e.target.result,n=v().read(t,{type:"binary"}),a=n.SheetNames[0],s=n.Sheets[a],o=v().utils.sheet_to_json(s,{header:1}),i=o[0],c=[],l={iserror:!1,msg:""};if("Task ID"===o[0][0]&&"Site ID"===o[0][2]&&"Site Name"===o[0][3]){for(var d=1;d<o.length;d++){var u=r.filter((function(e){return o[d][0]==e.taskRef}));if(0==u.length){l={iserror:!0,msg:"Please check the Task ID: ".concat(o[d][0])};break}if(!ft(u[0].headerProperties,i.slice(1))){l={iserror:!0,msg:"Please check the header"};break}if(o[d][2]!=u[0].siteID){l={iserror:!0,msg:"Please check the Site ID of Task : ".concat(o[d][0])};break}if(o[d][3]!=u[0].siteName){l={iserror:!0,msg:"Please check the Site Name of Task : ".concat(o[d][0])};break}if(o[d].length!=u[0].properties.length+1){l={iserror:!0,msg:"Please check the number of attributes : ".concat(o[d][0])};break}}if(l.iserror)st.current.value="",L(!0),M("error"),V(l.msg),we([]),Ce([]);else{for(d=0;d<o[0].length;d++){var h={field:o[0][d],headerName:o[0][d],minWidth:150,flex:1};c.push(h)}Ce(c),o.splice(0,1),xe(o),we(jt(i,o))}}else st.current.value="",L(!0),M("error"),V("Task ID, Site ID and Site Name should be in Column No 1, 3 and 4"),we([]),Ce([])},t?mt(t)?n.readAsBinaryString(t):alert("Invalid file"):we([])},ref:st,type:"file",isInvalid:!!fe.file}),(0,C.jsx)(m.Z.Control.Feedback,{type:"invalid",children:fe.file})]})}),(0,C.jsx)(f.Z,{children:(0,C.jsx)("div",{style:{height:610,width:"100%"},children:(0,C.jsx)(d._$r,{getRowId:function(e){return e.id},rows:Ie,columns:Ne,pageSize:15,rowsPerPageOptions:[15],rowHeight:30,headerHeight:40,components:{Toolbar:d.npt}})})}),(0,C.jsx)(f.Z,{children:(0,C.jsxs)(m.Z.Group,{className:"m-3",controlId:"refid",as:p.Z,children:[(0,C.jsx)(m.Z.Label,{children:"Reason for the change request"}),(0,C.jsx)(m.Z.Control,{as:"textarea",rows:3,onChange:function(e){return X(e.target.value)},isInvalid:!!fe.comment}),(0,C.jsx)(m.Z.Control.Feedback,{type:"invalid",children:"Please provide comment"})]})}),(0,C.jsxs)(j.Z.Footer,{children:[(0,C.jsx)(u.Z,{variant:"secondary",onClick:it,children:"Close"}),(0,C.jsx)(u.Z,{variant:"primary",onClick:function(){var e=ht();Object.keys(e).length>0?pe(e):ge.forEach((function(e){var t=r.filter((function(t){return e[0]==t.taskRef})),n=e;n.splice(0,1),ct.post("projonline/addhandoverchanges",{taskRef:t[0].taskRef,siteID:t[0].siteID,siteName:t[0].siteName,existingProperties:t[0].properties,newProperties:n,headerProperties:t[0].headerProperties,project:t[0].project,assignedProjectManager:t[0].assignedProjectManager,subProject:t[0].subProject,taskRefID:t[0]._id,status:"Pending",taskStatus:se,comment:te},{headers:{token:"Bearer "+JSON.parse(localStorage.getItem("user")).accessToken}}).then((function(e){})).catch((function(e){console.log(e)})),ct.put("projonline/update/".concat(t[0]._id),{taskObject:{},taskHistory:{taskStatus:"Handover change requested",comment:te}},{headers:{token:"Bearer "+JSON.parse(localStorage.getItem("user")).accessToken}}).then((function(e){L(!0),X(""),M("success"),V("Handover successfully requested"),it()})).catch((function(e){X(""),L(!0),M("error"),V("Error occured")}))}))},children:"Request approval"})]})]})})]}),(0,C.jsxs)(j.Z,{show:Ye,onHide:ot,size:"lg",animation:!1,children:[(0,C.jsx)(j.Z.Header,{closeButton:!0,children:(0,C.jsx)(j.Z.Title,{children:"Edit Handover"})}),(0,C.jsxs)(j.Z.Body,{children:[(0,C.jsxs)(m.Z,{children:[null===_||void 0===_?void 0:_.map((function(e,t){return t<3?(0,C.jsx)(f.Z,{children:(0,C.jsxs)(m.Z.Group,{className:"m-2",controlId:"refid",as:p.Z,children:[(0,C.jsx)(m.Z.Label,{children:e}),(0,C.jsx)(m.Z.Control,{className:"mr-1 ml-1",value:R[t],onChange:function(e){return Ke(e,t)},type:"text",readOnly:!0})]})}):(0,C.jsx)(f.Z,{children:(0,C.jsxs)(m.Z.Group,{className:"m-2",controlId:"refid",as:p.Z,children:[(0,C.jsx)(m.Z.Label,{children:e}),(0,C.jsx)(m.Z.Control,{value:R[t],onChange:function(e){return Ke(e,t)},type:"text"})]})})})),(0,C.jsx)(f.Z,{children:(0,C.jsxs)(m.Z.Group,{className:"m-3",controlId:"refid",as:p.Z,children:[(0,C.jsx)(m.Z.Label,{children:"Reason for the change request"}),(0,C.jsx)(m.Z.Control,{as:"textarea",value:Q,rows:3,onChange:function(e){return X(e.target.value)},isInvalid:!!fe.comment}),(0,C.jsx)(m.Z.Control.Feedback,{type:"invalid",children:"Please provide comment"})]})}),(0,C.jsx)(f.Z,{children:(0,C.jsxs)(m.Z.Group,{className:"m-3",controlId:"refid",as:p.Z,children:[(0,C.jsx)(m.Z.Label,{children:" Change Handover Approver"}),(0,C.jsxs)(m.Z.Control,{as:"select",defaultValue:Z.taskStatus,onChange:function(e){return Ae(e.target.value)},children:[(0,C.jsx)("option",{value:"",children:"Choose..."}),Ee.map((function(e){return(0,C.jsx)("option",{value:e._id,children:e.name},e._id)}))]})]})}),(0,C.jsx)(j.Z.Footer,{children:(0,C.jsx)(u.Z,{variant:"primary",onClick:function(){var e=ht();Object.keys(e).length>0?pe(e):(ct.post("projonline/addhandoverchanges",{taskRef:Z.taskRef,siteID:Z.siteID,siteName:Z.siteName,newProperties:R,existingProperties:Z.properties,headerProperties:_,project:Z.project,assignedProjectManager:Z.assignedProjectManager,subProject:Z.subProject,taskRefID:Z._id,status:"Pending",changeHandOverUser:Le,comment:Q},{headers:{token:"Bearer "+JSON.parse(localStorage.getItem("user")).accessToken}}).then((function(e){})).catch((function(e){console.log(e)})),ct.put("projonline/update/".concat(Z._id),{taskObject:{},taskHistory:{taskStatus:"Handover change requested",comment:Q}},{headers:{token:"Bearer "+JSON.parse(localStorage.getItem("user")).accessToken}}).then((function(e){L(!0),M("success"),V("Handover successfully requested"),et(!1)})).catch((function(e){L(!0),M("error"),V("Error occured")})))},children:"Request approval"})})]}),(0,C.jsx)(f.Z,{children:(0,C.jsxs)(m.Z.Group,{className:"m-3",controlId:"refid",as:p.Z,children:[(0,C.jsx)(m.Z.Label,{children:"Change Status"}),(0,C.jsxs)(m.Z.Control,{as:"select",defaultValue:Z.taskStatus,onChange:function(e){return oe(e.target.value)},children:[(0,C.jsx)("option",{hidden:!0,value:Z.taskStatus,children:Z.taskStatus}),(0,C.jsx)("option",{value:"Withdraw",children:"Withdraw"}),"Hold"==(null===Z||void 0===Z?void 0:Z.taskStatus)?(0,C.jsx)("option",{value:le,children:"Continue..."}):(0,C.jsx)("option",{value:"Hold",children:"Hold"})]})]})}),(0,C.jsx)(f.Z,{children:(0,C.jsxs)(m.Z.Group,{className:"m-3",controlId:"refid",as:p.Z,children:[(0,C.jsx)(m.Z.Label,{children:" Change Handover Approver"}),(0,C.jsxs)(m.Z.Control,{as:"select",defaultValue:Z.taskStatus,onChange:function(e){return Ae(e.target.value)},children:[(0,C.jsx)("option",{value:"",children:"Choose..."}),Ee.map((function(e){return(0,C.jsx)("option",{value:e._id,children:e.name},e._id)}))]})]})}),(0,C.jsx)(f.Z,{children:(0,C.jsxs)(m.Z.Group,{className:"m-3",controlId:"refid",as:p.Z,children:[(0,C.jsx)(m.Z.Label,{children:"Reason for the Status Change"}),(0,C.jsx)(m.Z.Control,{as:"textarea",rows:3,value:te,onChange:function(e){return re(e.target.value)},isInvalid:!!fe.commentStatus}),(0,C.jsx)(m.Z.Control.Feedback,{type:"invalid",children:"Please provide comment"})]})}),(0,C.jsx)(f.Z,{children:(0,C.jsxs)(m.Z.Group,{className:"m-3",controlId:"refid",as:p.Z,children:[(0,C.jsx)(m.Z.Label,{children:"Project Manager"})," - "+Me]})})]}),(0,C.jsxs)(j.Z.Footer,{children:[(0,C.jsx)(u.Z,{variant:"secondary",onClick:ot,children:"Close"}),(0,C.jsx)(u.Z,{variant:"primary",onClick:function(){var e=function(){var e={};return te&&""!==te||(e.commentStatus="cannot be blank!"),e}();Object.keys(e).length>0?pe(e):se!=Z.taskStatus&&(ct.post("projonline/addhandoverchanges",{taskRef:Z.taskRef,siteID:Z.siteID,siteName:Z.siteName,newProperties:R,existingProperties:Z.properties,headerProperties:_,project:Z.project,assignedProjectManager:Z.assignedProjectManager,subProject:Z.subProject,taskRefID:Z._id,status:"Pending",taskStatus:se,changeHandOverUser:Le,comment:"Approver: ".concat(Ve," / Reason: ").concat(te)},{headers:{token:"Bearer "+JSON.parse(localStorage.getItem("user")).accessToken}}).then((function(e){})).catch((function(e){console.log(e)})),ct.put("projonline/update/".concat(Z._id),{taskObject:{},taskHistory:{taskStatus:"".concat(se," requested"),comment:"Approver: ".concat(Ve," / Reason: ").concat(te)}},{headers:{token:"Bearer "+JSON.parse(localStorage.getItem("user")).accessToken}}).then((function(e){L(!0),M("success"),V("status change successfully requested"),et(!1)})).catch((function(e){L(!0),M("error"),V("Error occured")})))},disabled:Z.taskStatus===se,children:"Change Status"})]})]}),(0,C.jsx)(g.Z,{open:G,autoHideDuration:6e3,onClose:pt,anchorOrigin:{vertical:"top",horizontal:"center"},children:(0,C.jsx)(y,{onClose:pt,severity:F,sx:{width:"100%"},children:W})}),(0,C.jsx)(k.Z,{open:Oe,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:(0,C.jsx)(b.Z,{children:(0,C.jsx)(S.Z,{sx:{display:"flex"},children:(0,C.jsx)(N.Z,{})})})})]})}))},47022:function(e,t,r){"use strict";var n=r(87462),a=r(63366),s=r(81694),o=r.n(s),i=r(72791),c=r(10162),l=["bsPrefix","fluid","as","className"],d=i.forwardRef((function(e,t){var r=e.bsPrefix,s=e.fluid,d=e.as,u=void 0===d?"div":d,h=e.className,f=(0,a.Z)(e,l),p=(0,c.vE)(r,"container"),j="string"===typeof s?"-"+s:"-fluid";return i.createElement(u,(0,n.Z)({ref:t},f,{className:o()(h,s?""+p+j:p)}))}));d.displayName="Container",d.defaultProps={fluid:!1},t.Z=d},2468:function(){},55382:function(){},72095:function(){},61219:function(){}}]);
//# sourceMappingURL=3338.52053692.chunk.js.map