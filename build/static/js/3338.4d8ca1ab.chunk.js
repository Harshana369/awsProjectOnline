(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[3338],{64681:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>C});var a=s(72791),r=s(79271),n=s(74569),o=s.n(n),i=s(3986),l=(s(2468),s(43360)),c=s(47022),d=s(89743),h=s(2677),u=s(39474),j=s(16149),p=s(34575),m=s(19658),g=s(58484),x=s.n(g),f=s(29818),k=s(64554),v=s(39157),Z=s(13239),S=s(80184);const b=a.forwardRef((function(e,t){return(0,S.jsx)(m.Z,{elevation:6,ref:t,variant:"filled",...e})})),N=["csv","xls","xlsx"];const C=(0,r.EN)((function(){let[e,t]=(0,a.useState)([]),[s,r]=(0,a.useState)([]),[n,m]=(0,a.useState)([]),[g,C]=(0,a.useState)([]),[y,P]=(0,a.useState)(!1),[I,w]=(0,a.useState)(""),[H,R]=(0,a.useState)(""),[O,D]=(0,a.useState)(""),[T,_]=(0,a.useState)(""),[E,B]=(0,a.useState)(""),[q,G]=(0,a.useState)(""),[L,A]=(0,a.useState)({}),[J,F]=(0,a.useState)([]),[M,z]=(0,a.useState)([]),[U,W]=(0,a.useState)([]),[V,$]=(0,a.useState)([]),[K,Q]=(0,a.useState)(!1),[X,Y]=(0,a.useState)([]),[ee,te]=(0,a.useState)(),[se,ae]=(0,a.useState)(),[re,ne]=(0,a.useState)();const oe=(e,t)=>{m({...n,[t]:e.target.value})},[ie,le]=(0,a.useState)(!1),[ce,de]=(0,a.useState)(!1),he=(0,a.useRef)(),ue=()=>le(!1),je=()=>{$([]),F([]),de(!1)},pe=o().create({baseURL:"http://35.78.68.113:8072/"});(0,a.useEffect)((()=>{me(),Q(!0),ge(),pe.get("projonline/project",{headers:{token:"Bearer "+JSON.parse(localStorage.getItem("user")).accessToken}}).then((e=>{z(e.data.projTemplates)})).catch((e=>{console.log(e)}))}),[]),(0,a.useEffect)((()=>{xe()}),[ee]);const me=()=>{pe.get("projonline/mobitelusers",{headers:{token:"Bearer "+JSON.parse(localStorage.getItem("user")).accessToken}}).then((e=>{const t=e.data.map((e=>({name:e.name,_id:e._id})));Y(t)})).catch((e=>{console.log(e)}))},ge=()=>{pe.get("projonline/gettasks",{headers:{token:"Bearer "+JSON.parse(localStorage.getItem("user")).accessToken}}).then((e=>{const s=e.data.tasks.filter((e=>{if("Withdraw"!=e.taskStatus)return e}));t(s),Q(!1)})).catch((e=>{console.log(e)}))},xe=()=>{let e=null;X.forEach((t=>{t._id===ee&&(e=t.name)})),ne(e)},fe=()=>{const e={};return O&&""!==O||(e.comment="cannot be blank!"),e};function ke(e,t){return Array.isArray(e)&&Array.isArray(t)&&e.length===t.length&&e.every(((e,s)=>e===t[s]))}const ve=(e,t)=>{"clickaway"!==t&&P(!1)},Ze=(e,t)=>{const s=[];return t.forEach(((t,a)=>{let r={};r.id=a,t.forEach(((t,s)=>{r[e[s]]=t})),s.push(r)})),s},Se=e=>{const t=e.name.split("."),s=t[t.length-1];return N.includes(s)},be=[{field:"taskRef",headerName:"TaskID",width:250},{field:"SiteID",headerName:"SiteID",width:150,valueGetter:e=>e.row.properties[1]},{field:"Site Name",headerName:"Site Name",width:175,valueGetter:e=>e.row.properties[2]},{field:"project",headerName:"Project",width:175},{field:"subProject",headerName:"Sub Project",width:175},{field:"Change the Handover",width:250,align:"center",renderCell:e=>(0,S.jsx)(l.Z,{variant:"primary",style:{width:100},onClick:()=>{(e=>{let t=null;X.forEach((s=>{s._id===e&&(t=s.name)})),ae(t)})(e.row.assignedProjectManager),(e=>{r(e);for(var t=e.taskHistory.length-2;t>=0;t--)if("Hold requested"==e.taskHistory[t+1].taskStatus){G(e.taskHistory[t].taskStatus);break}m(e.properties),C(e.headerProperties),B(e.taskStatus),D(""),le(!0)})(e.row)},children:"Edit"})}];return(0,S.jsxs)("div",{children:[(0,S.jsxs)("div",{className:"content-wrapper",children:[(0,S.jsx)("div",{className:"content-header",children:(0,S.jsx)("section",{className:"content-header",children:(0,S.jsx)("div",{className:"container-fluid",children:(0,S.jsx)("div",{children:(0,S.jsx)("div",{children:(0,S.jsx)(c.Z,{children:(0,S.jsxs)(d.Z,{children:[(0,S.jsx)(h.Z,{xs:4,children:(0,S.jsx)("h1",{children:"Request Handover Changes"})}),(0,S.jsx)(h.Z,{xs:2}),(0,S.jsx)(h.Z,{children:(0,S.jsx)("div",{className:"vr"})}),(0,S.jsx)(h.Z,{children:(0,S.jsx)("div",{className:"vr"})}),(0,S.jsx)(h.Z,{children:(0,S.jsx)(l.Z,{variant:"primary",type:"button",onClick:()=>de(!0),children:"Handover Bulk Changes"})})]})})})})})})}),(0,S.jsx)("div",{style:{height:610,width:"100%"},children:(0,S.jsx)(i._$r,{getRowId:e=>e._id,rows:e,columns:be,pageSize:15,rowsPerPageOptions:[15],rowHeight:30,headerHeight:40,components:{Toolbar:i.npt}})})]}),(0,S.jsxs)(u.Z,{show:ce,onHide:je,animation:!1,dialogClassName:"bulk-modal-size",children:[(0,S.jsx)(u.Z.Header,{closeButton:!0,children:(0,S.jsx)(u.Z.Title,{children:"Edit Handover"})}),(0,S.jsx)(u.Z.Body,{children:(0,S.jsxs)(j.Z,{children:[(0,S.jsx)(d.Z,{className:"mb-3",children:(0,S.jsxs)(j.Z.Group,{as:h.Z,children:[(0,S.jsx)(j.Z.Label,{children:"Upload edited task handover"}),(0,S.jsx)(j.Z.Control,{onChange:t=>{const s=t.target.files[0];A({...L,file:null});const a=new FileReader;a.onload=t=>{const s=t.target.result,a=x().read(s,{type:"binary"}),r=a.SheetNames[0],n=a.Sheets[r],o=x().utils.sheet_to_json(n,{header:1}),i=o[0],l=[];let c={iserror:!1,msg:""};if("Task ID"===o[0][0]&&"Site ID"===o[0][2]&&"Site Name"===o[0][3]){for(var d=1;d<o.length;d++){let t=e.filter((e=>o[d][0]==e.taskRef));if(0==t.length){c={iserror:!0,msg:"Please check the Task ID: ".concat(o[d][0])};break}if(!ke(t[0].headerProperties,i.slice(1))){c={iserror:!0,msg:"Please check the header"};break}if(o[d][2]!=t[0].siteID){c={iserror:!0,msg:"Please check the Site ID of Task : ".concat(o[d][0])};break}if(o[d][3]!=t[0].siteName){c={iserror:!0,msg:"Please check the Site Name of Task : ".concat(o[d][0])};break}if(o[d].length!=t[0].properties.length+1){c={iserror:!0,msg:"Please check the number of attributes : ".concat(o[d][0])};break}}if(c.iserror)he.current.value="",P(!0),w("error"),R(c.msg),$([]),W([]);else{for(d=0;d<o[0].length;d++){let e={field:o[0][d],headerName:o[0][d],minWidth:150,flex:1};l.push(e)}W(l),o.splice(0,1),F(o),$(Ze(i,o))}}else he.current.value="",P(!0),w("error"),R("Task ID, Site ID and Site Name should be in Column No 1, 3 and 4"),$([]),W([])},s?Se(s)?a.readAsBinaryString(s):alert("Invalid file"):$([])},ref:he,type:"file",isInvalid:!!L.file}),(0,S.jsx)(j.Z.Control.Feedback,{type:"invalid",children:L.file})]})}),(0,S.jsx)(d.Z,{children:(0,S.jsx)("div",{style:{height:610,width:"100%"},children:(0,S.jsx)(i._$r,{getRowId:e=>e.id,rows:V,columns:U,pageSize:15,rowsPerPageOptions:[15],rowHeight:30,headerHeight:40,components:{Toolbar:i.npt}})})}),(0,S.jsx)(d.Z,{children:(0,S.jsxs)(j.Z.Group,{className:"m-3",controlId:"refid",as:h.Z,children:[(0,S.jsx)(j.Z.Label,{children:"Reason for the change request"}),(0,S.jsx)(j.Z.Control,{as:"textarea",rows:3,onChange:e=>D(e.target.value),isInvalid:!!L.comment}),(0,S.jsx)(j.Z.Control.Feedback,{type:"invalid",children:"Please provide comment"})]})}),(0,S.jsxs)(u.Z.Footer,{children:[(0,S.jsx)(l.Z,{variant:"secondary",onClick:je,children:"Close"}),(0,S.jsx)(l.Z,{variant:"primary",onClick:()=>{const t=fe();Object.keys(t).length>0?A(t):J.forEach((t=>{const s=e.filter((e=>t[0]==e.taskRef));let a=t;a.splice(0,1),pe.post("projonline/addhandoverchanges",{taskRef:s[0].taskRef,siteID:s[0].siteID,siteName:s[0].siteName,existingProperties:s[0].properties,newProperties:a,headerProperties:s[0].headerProperties,project:s[0].project,assignedProjectManager:s[0].assignedProjectManager,subProject:s[0].subProject,taskRefID:s[0]._id,status:"Pending",taskStatus:E,comment:T},{headers:{token:"Bearer "+JSON.parse(localStorage.getItem("user")).accessToken}}).then((e=>{})).catch((e=>{console.log(e)})),pe.put("projonline/update/".concat(s[0]._id),{taskObject:{},taskHistory:{taskStatus:"Handover change requested",comment:T}},{headers:{token:"Bearer "+JSON.parse(localStorage.getItem("user")).accessToken}}).then((e=>{P(!0),D(""),w("success"),R("Handover successfully requested"),je()})).catch((e=>{D(""),P(!0),w("error"),R("Error occured")}))}))},children:"Request approval"})]})]})})]}),(0,S.jsxs)(u.Z,{show:ie,onHide:ue,size:"lg",animation:!1,children:[(0,S.jsx)(u.Z.Header,{closeButton:!0,children:(0,S.jsx)(u.Z.Title,{children:"Edit Handover"})}),(0,S.jsxs)(u.Z.Body,{children:[(0,S.jsxs)(j.Z,{children:[null===g||void 0===g?void 0:g.map(((e,t)=>t<3?(0,S.jsx)(d.Z,{children:(0,S.jsxs)(j.Z.Group,{className:"m-2",controlId:"refid",as:h.Z,children:[(0,S.jsx)(j.Z.Label,{children:e}),(0,S.jsx)(j.Z.Control,{className:"mr-1 ml-1",value:n[t],onChange:e=>oe(e,t),type:"text",readOnly:!0})]})}):(0,S.jsx)(d.Z,{children:(0,S.jsxs)(j.Z.Group,{className:"m-2",controlId:"refid",as:h.Z,children:[(0,S.jsx)(j.Z.Label,{children:e}),(0,S.jsx)(j.Z.Control,{value:n[t],onChange:e=>oe(e,t),type:"text"})]})}))),(0,S.jsx)(d.Z,{children:(0,S.jsxs)(j.Z.Group,{className:"m-3",controlId:"refid",as:h.Z,children:[(0,S.jsx)(j.Z.Label,{children:"Reason for the change request"}),(0,S.jsx)(j.Z.Control,{as:"textarea",value:O,rows:3,onChange:e=>D(e.target.value),isInvalid:!!L.comment}),(0,S.jsx)(j.Z.Control.Feedback,{type:"invalid",children:"Please provide comment"})]})}),(0,S.jsx)(d.Z,{children:(0,S.jsxs)(j.Z.Group,{className:"m-3",controlId:"refid",as:h.Z,children:[(0,S.jsx)(j.Z.Label,{children:" Change Handover Approver"}),(0,S.jsxs)(j.Z.Control,{as:"select",defaultValue:s.taskStatus,onChange:e=>te(e.target.value),children:[(0,S.jsx)("option",{value:"",children:"Choose..."}),X.map((e=>(0,S.jsx)("option",{value:e._id,children:e.name},e._id)))]})]})}),(0,S.jsx)(u.Z.Footer,{children:(0,S.jsx)(l.Z,{variant:"primary",onClick:()=>{const e=fe();Object.keys(e).length>0?A(e):(pe.post("projonline/addhandoverchanges",{taskRef:s.taskRef,siteID:s.siteID,siteName:s.siteName,newProperties:n,existingProperties:s.properties,headerProperties:g,project:s.project,assignedProjectManager:s.assignedProjectManager,subProject:s.subProject,taskRefID:s._id,status:"Pending",changeHandOverUser:ee,comment:O},{headers:{token:"Bearer "+JSON.parse(localStorage.getItem("user")).accessToken}}).then((e=>{})).catch((e=>{console.log(e)})),pe.put("projonline/update/".concat(s._id),{taskObject:{},taskHistory:{taskStatus:"Handover change requested",comment:O}},{headers:{token:"Bearer "+JSON.parse(localStorage.getItem("user")).accessToken}}).then((e=>{P(!0),w("success"),R("Handover successfully requested"),le(!1)})).catch((e=>{P(!0),w("error"),R("Error occured")})))},children:"Request approval"})})]}),(0,S.jsx)(d.Z,{children:(0,S.jsxs)(j.Z.Group,{className:"m-3",controlId:"refid",as:h.Z,children:[(0,S.jsx)(j.Z.Label,{children:"Change Status"}),(0,S.jsxs)(j.Z.Control,{as:"select",defaultValue:s.taskStatus,onChange:e=>B(e.target.value),children:[(0,S.jsx)("option",{hidden:!0,value:s.taskStatus,children:s.taskStatus}),(0,S.jsx)("option",{value:"Withdraw",children:"Withdraw"}),"Hold"==(null===s||void 0===s?void 0:s.taskStatus)?(0,S.jsx)("option",{value:q,children:"Continue..."}):(0,S.jsx)("option",{value:"Hold",children:"Hold"})]})]})}),(0,S.jsx)(d.Z,{children:(0,S.jsxs)(j.Z.Group,{className:"m-3",controlId:"refid",as:h.Z,children:[(0,S.jsx)(j.Z.Label,{children:" Change Handover Approver"}),(0,S.jsxs)(j.Z.Control,{as:"select",defaultValue:s.taskStatus,onChange:e=>te(e.target.value),children:[(0,S.jsx)("option",{value:"",children:"Choose..."}),X.map((e=>(0,S.jsx)("option",{value:e._id,children:e.name},e._id)))]})]})}),(0,S.jsx)(d.Z,{children:(0,S.jsxs)(j.Z.Group,{className:"m-3",controlId:"refid",as:h.Z,children:[(0,S.jsx)(j.Z.Label,{children:"Reason for the Status Change"}),(0,S.jsx)(j.Z.Control,{as:"textarea",rows:3,value:T,onChange:e=>_(e.target.value),isInvalid:!!L.commentStatus}),(0,S.jsx)(j.Z.Control.Feedback,{type:"invalid",children:"Please provide comment"})]})}),(0,S.jsx)(d.Z,{children:(0,S.jsxs)(j.Z.Group,{className:"m-3",controlId:"refid",as:h.Z,children:[(0,S.jsx)(j.Z.Label,{children:"Project Manager"})," - "+se]})})]}),(0,S.jsxs)(u.Z.Footer,{children:[(0,S.jsx)(l.Z,{variant:"secondary",onClick:ue,children:"Close"}),(0,S.jsx)(l.Z,{variant:"primary",onClick:()=>{const e=(()=>{const e={};return T&&""!==T||(e.commentStatus="cannot be blank!"),e})();Object.keys(e).length>0?A(e):E!=s.taskStatus&&(pe.post("projonline/addhandoverchanges",{taskRef:s.taskRef,siteID:s.siteID,siteName:s.siteName,newProperties:n,existingProperties:s.properties,headerProperties:g,project:s.project,assignedProjectManager:s.assignedProjectManager,subProject:s.subProject,taskRefID:s._id,status:"Pending",taskStatus:E,changeHandOverUser:ee,comment:"Approver: ".concat(re," / Reason: ").concat(T)},{headers:{token:"Bearer "+JSON.parse(localStorage.getItem("user")).accessToken}}).then((e=>{})).catch((e=>{console.log(e)})),pe.put("projonline/update/".concat(s._id),{taskObject:{},taskHistory:{taskStatus:"".concat(E," requested"),comment:"Approver: ".concat(re," / Reason: ").concat(T)}},{headers:{token:"Bearer "+JSON.parse(localStorage.getItem("user")).accessToken}}).then((e=>{P(!0),w("success"),R("status change successfully requested"),le(!1)})).catch((e=>{P(!0),w("error"),R("Error occured")})))},disabled:s.taskStatus===E,children:"Change Status"})]})]}),(0,S.jsx)(p.Z,{open:y,autoHideDuration:6e3,onClose:ve,anchorOrigin:{vertical:"top",horizontal:"center"},children:(0,S.jsx)(b,{onClose:ve,severity:I,sx:{width:"100%"},children:H})}),(0,S.jsx)(f.Z,{open:K,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:(0,S.jsx)(v.Z,{children:(0,S.jsx)(k.Z,{sx:{display:"flex"},children:(0,S.jsx)(Z.Z,{})})})})]})}))},47022:(e,t,s)=>{"use strict";s.d(t,{Z:()=>h});var a=s(87462),r=s(63366),n=s(81694),o=s.n(n),i=s(72791),l=s(10162),c=["bsPrefix","fluid","as","className"],d=i.forwardRef((function(e,t){var s=e.bsPrefix,n=e.fluid,d=e.as,h=void 0===d?"div":d,u=e.className,j=(0,r.Z)(e,c),p=(0,l.vE)(s,"container"),m="string"===typeof n?"-"+n:"-fluid";return i.createElement(h,(0,a.Z)({ref:t},j,{className:o()(u,n?""+p+m:p)}))}));d.displayName="Container",d.defaultProps={fluid:!1};const h=d},2468:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});const a={}},55382:()=>{},72095:()=>{},61219:()=>{}}]);
//# sourceMappingURL=3338.4d8ca1ab.chunk.js.map