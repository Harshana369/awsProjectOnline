"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[385],{90385:(e,a,t)=>{t.r(a),t.d(a,{default:()=>g});var s=t(72791),i=t(79271),r=t(74569),n=t.n(r),o=t(89743),l=t(62591),d=t(16149),c=t(2677),p=t(43360),h=t(34575),u=t(19658),v=t(64554),f=t(39157),m=t(13239),x=t(29818),j=t(80184);const b=s.forwardRef((function(e,a){return(0,j.jsx)(u.Z,{elevation:6,ref:a,variant:"filled",...e})}));const g=(0,i.EN)((function(e){let[a,t]=(0,s.useState)([]),[i,r]=(0,s.useState)([]),[u,g]=(0,s.useState)([]),[k,Z]=(0,s.useState)([]),[C,y]=(0,s.useState)([]),[S,O]=(0,s.useState)([]),[T,I]=(0,s.useState)([]),[_,q]=(0,s.useState)(""),[M,R]=(0,s.useState)("");const P=n().create({baseURL:"http://35.78.68.113:8072/projonline"});let[A,N]=(0,s.useState)({}),[L,w]=(0,s.useState)([]),[B,G]=(0,s.useState)({}),[D,E]=(0,s.useState)(!1),[V,U]=(0,s.useState)(!1),[F,z]=(0,s.useState)("");const J=async a=>{const t=(()=>{const{boqApprovalRequirment:e}=A,a={};return e&&""!==e&&"Choose..."!==e||(a.boqApprovalRequirment="Choose a Boq status"),a})();if(Object.keys(t).length>0)G(t);else{a.preventDefault(),U(!0);const t=A.boqApprovalRequirment;try{const a=await P.put("projonline/boqProjectRequirement/".concat(t),L,{headers:{token:"Bearer "+JSON.parse(localStorage.getItem("user")).accessToken}});setTimeout((()=>{q(a.data.msg),R(a.data.variant),E(!0)}),1e3),setTimeout((()=>{e.history.push({pathname:"/modifyTask"})}),2e3)}catch(s){q("Error updating BOQ"),console.error("Error updating BOQ:",s)}}};let Q=(e,a)=>{N({...A,[e]:a}),B[e]&&G({...B,[e]:null})};(0,s.useEffect)((()=>{P.get("projonline/users",{headers:{token:"Bearer "+JSON.parse(localStorage.getItem("user")).accessToken}}).then((a=>{w(e.location.data),r(a.data.users.filter((e=>"Mobitel"!==e.company.companyName))),t(a.data.users.filter((e=>!0===e.userCanAssignForTask))),g(a.data.companys.filter((e=>"Mobitel"!==e.companyName))),Z(a.data.users),y([{_id:"",name:"Choose..."}]),O([{_id:"",name:"Choose..."}]),I([{_id:"",name:"Choose..."}])})).catch((e=>{console.log(e)}))}),[]);const H=a=>{const t=(()=>{const{taskStatus:e}=A,a={};return e&&""!==e&&"Choose..."!==e||(a.taskStatus="Choose a task status"),a})();Object.keys(t).length>0?G(t):(a.preventDefault(),U(!0),P.post("projonline/update",{tasks:L,taskObject:{taskStatus:A.taskStatus},taskHistory:{taskStatus:"Status Changed",comment:"Task Status Changed to > "+A.taskStatus}},{headers:{token:"Bearer "+JSON.parse(localStorage.getItem("user")).accessToken}}).then((a=>{q(a.data.msg),R(a.data.variant),E(!0),setTimeout((()=>{U(!1),E(!1),w([]),e.history.push({pathname:"/modifyTask"})}),1e3)})).catch((e=>{console.log(e)})))},Y=(e,a)=>{"clickaway"!==a&&E(!1)};function K(e,a){return e&&e.approvalPath&&e.approvalPath.length>0?e.approvalPath.map(((e,a)=>{const t=e.assignedOfficer;return(0,j.jsx)("div",{children:(0,j.jsxs)("div",{children:[e.approvalLevel," : ",t.name]})},a)})):"No approval path found"}for(var W=0;W<L.length;W++)"Task accepted"!==L[W].taskStatus&&"Task commenced"!==L[W].taskStatus&&(document.getElementById("formChangeTaskStatus").disabled=!0,document.getElementById("btnChangeTaskStatus").disabled=!0);for(W=0;W<L.length;W++)"Task handed over"!==L[W].taskStatus&&"Subcon allocated"!==L[W].taskStatus&&"Task accepted"!==L[W].taskStatus&&"Task completed"!==L[W].taskStatus&&"Task commenced"!==L[W].taskStatus&&"Task rejected"!==L[W].taskStatus&&(document.getElementById("formChangeBoqApprovalRequirment").disabled=!0,document.getElementById("btnChangeBoqApprovalRequirement").disabled=!0);return(0,j.jsxs)("div",{children:[(0,j.jsxs)("div",{className:"content-wrapper",children:[(0,j.jsx)("div",{className:"content-header",children:(0,j.jsx)("section",{className:"content-header",children:(0,j.jsx)("div",{className:"container-fluid",children:(0,j.jsx)("div",{className:"row mb-2",children:(0,j.jsx)("div",{className:"col-sm-6",children:(0,j.jsx)("h1",{children:"Modify Task"})})})})})}),(0,j.jsx)("section",{className:"content",children:(0,j.jsx)("div",{className:"container-fluid",children:(0,j.jsxs)("form",{children:[(0,j.jsx)("div",{children:(0,j.jsx)(o.Z,{children:(0,j.jsxs)(l.Z,{striped:!0,bordered:!0,hover:!0,size:"sm",children:[(0,j.jsx)("thead",{children:(0,j.jsxs)("tr",{children:[(0,j.jsx)("th",{children:"Task Ref"}),(0,j.jsx)("th",{children:"Site ID"}),(0,j.jsx)("th",{children:"Site Name"}),(0,j.jsx)("th",{children:"Assigned Mobitel Officer"}),(0,j.jsx)("th",{children:"Task Status"}),(0,j.jsx)("th",{children:"BOQ"}),(0,j.jsx)("th",{children:"Approval Path"})]})}),(0,j.jsx)("tbody",{children:L.map(((e,a)=>(0,j.jsxs)("tr",{children:[(0,j.jsx)("td",{children:e.taskRef}),(0,j.jsx)("td",{children:e.siteID}),(0,j.jsx)("td",{children:e.siteName}),(0,j.jsx)("td",{children:e.assignedMobitelOfficer.name}),(0,j.jsx)("td",{children:e.taskStatus}),(0,j.jsx)("td",{children:!0===e.boqprojectrequirement?"Required":!1===e.boqprojectrequirement?"Not Required":"Required"}),(0,j.jsx)("td",{children:K(e)})]},a)))})]})})}),(0,j.jsxs)("div",{style:{border:"1px solid #ccc",padding:"10px"},children:[(0,j.jsxs)(o.Z,{children:[(0,j.jsxs)(d.Z.Group,{as:c.Z,children:[(0,j.jsx)(d.Z.Label,{children:"Change Task Status"}),(0,j.jsxs)(d.Z.Control,{id:"formChangeTaskStatus",onChange:e=>{Q("taskStatus",e.target.value)},value:A.taskStatus,as:"select",defaultValue:"item.taskStatus",isInvalid:!!B.taskStatus,children:[(0,j.jsx)("option",{children:"Choose..."}),(0,j.jsx)("option",{children:"Task handed over"})]}),(0,j.jsx)(d.Z.Control.Feedback,{type:"invalid",children:B.taskStatus})]}),(0,j.jsxs)(d.Z.Group,{as:c.Z,children:[(0,j.jsx)(d.Z.Label,{children:"Update Task Status"}),(0,j.jsx)("br",{}),(0,j.jsx)(p.Z,{onClick:e=>H(e),variant:"primary",type:"button",style:{width:"130px",height:"30px"},id:"btnChangeTaskStatus",children:"Update Task Status"})]}),(0,j.jsx)(d.Z.Group,{as:c.Z})]}),(0,j.jsx)(o.Z,{children:(0,j.jsx)(d.Z,{children:(0,j.jsx)(d.Z.Group,{as:c.Z,children:(0,j.jsx)(d.Z.Label,{style:{fontSize:11},children:'** You can\'t change the status once the task already submitted as "Task completed"'})})})})]}),(0,j.jsx)(o.Z,{children:(0,j.jsx)(d.Z,{children:(0,j.jsx)("br",{})})}),(0,j.jsxs)("div",{style:{border:"1px solid #ccc",padding:"10px"},children:[(0,j.jsxs)(o.Z,{children:[(0,j.jsxs)(d.Z.Group,{as:c.Z,children:[(0,j.jsx)(d.Z.Label,{children:"Re-Assign To"}),(0,j.jsxs)(d.Z.Control,{onChange:e=>{const a=e.target.selectedOptions[0];a.value;F=a.getAttribute("name");const t=a.getAttribute("name");z(t),"Choose..."===e.target.value&&(Q("assignedMobitelOfficer",e.target.value),y([{_id:"",name:"Choose..."}]),O([{_id:"",name:"Choose..."}]),I([{_id:"",name:"Choose..."}]));for(let s=0;s<k.length;s++)if(k[s]._id===e.target.value)switch(k[s].approvalPath.length){case 0:y([{_id:"",name:"Choose..."}]),O([{_id:"",name:"Choose..."}]),I([{_id:"",name:"Choose..."}]),N({...A,verificationOneId:"",verificationTwoId:"",approvalId:"",assignedMobitelOfficer:e.target.value,approvalType:"Default"}),B.assignedMobitelOfficer&&G({...B,assignedMobitelOfficer:null});break;case 1:y([{_id:k[s].approvalPath[0]._id,name:k[s].approvalPath[0].name}]),Q("verificationOneId",k[s].approvalPath[0]._id),O([{_id:"",name:"Choose..."}]),I([{_id:"",name:"Choose..."}]),N({...A,verificationOneId:k[s].approvalPath[0]._id,verificationTwoId:"",approvalId:"",assignedMobitelOfficer:e.target.value,approvalType:"Default"}),B.assignedMobitelOfficer&&G({...B,assignedMobitelOfficer:null});break;case 2:y([{_id:k[s].approvalPath[0]._id,name:k[s].approvalPath[0].name}]),O([{_id:"",name:"Choose...."}]),I([{_id:k[s].approvalPath[1]._id,name:k[s].approvalPath[1].name}]),N({...A,verificationOneId:k[s].approvalPath[0]._id,verificationTwoId:"",approvalId:k[s].approvalPath[1]._id,assignedMobitelOfficer:e.target.value,approvalType:"Default"}),B.assignedMobitelOfficer&&G({...B,assignedMobitelOfficer:null});break;case 3:y([{_id:k[s].approvalPath[0]._id,name:k[s].approvalPath[0].name}]),O([{_id:k[s].approvalPath[1]._id,name:k[s].approvalPath[1].name}]),I([{_id:k[s].approvalPath[2]._id,name:k[s].approvalPath[2].name}]),N({...A,verificationOneId:k[s].approvalPath[0]._id,verificationTwoId:k[s].approvalPath[1]._id,approvalId:k[s].approvalPath[2]._id,assignedMobitelOfficer:e.target.value,approvalType:"Default"}),B.assignedMobitelOfficer&&G({...B,assignedMobitelOfficer:null})}},as:"select",value:A.assignedMobitelOfficer,defaultValue:"Choose...",isInvalid:!!B.assignedMobitelOfficer,children:[(0,j.jsx)("option",{children:"Choose..."}),a.map((e=>(0,j.jsx)("option",{value:e._id,name:e.name,children:e.name})))]}),(0,j.jsx)(d.Z.Control.Feedback,{type:"invalid",children:B.assignedMobitelOfficer})]}),(0,j.jsxs)(d.Z.Group,{as:c.Z,children:[(0,j.jsx)(d.Z.Label,{children:"Re-Assign"}),(0,j.jsx)("br",{}),(0,j.jsx)(p.Z,{onClick:a=>{a.preventDefault();const t=(()=>{const{assignedMobitelOfficer:e}=A,a={};return e&&""!==e&&"Choose..."!==e||(a.assignedMobitelOfficer="Choose a Mobitel Officer!"),a})();if(Object.keys(t).length>0)G(t);else{var s=[{approvalLevel:"Verification Level 0",assignedOfficer:A.assignedMobitelOfficer},{approvalLevel:"Verification Level 1",assignedOfficer:A.verificationOneId},{approvalLevel:"Verification Level 2",assignedOfficer:A.verificationTwoId},{approvalLevel:"Final approval",assignedOfficer:A.approvalId}].filter((e=>""!=e.assignedOfficer));const a={assignedMobitelOfficer:A.assignedMobitelOfficer,approvalPath:s};U(!0),P.post("projonline/update",{tasks:L,taskObject:a,taskHistory:{taskStatus:"Mobitel Officer Re-Assigned",comment:"Task Re-Assigned to > "+F}},{headers:{token:"Bearer "+JSON.parse(localStorage.getItem("user")).accessToken}}).then((a=>{setTimeout((()=>{q(a.data.msg),R(a.data.variant),E(!0)}),2e3),setTimeout((()=>{U(!1),E(!1),y([{_id:"",name:"Choose..."}]),O([{_id:"",name:"Choose..."}]),I([{_id:"",name:"Choose..."}]),w([]),N({verificationOneId:"",verificationTwoId:"",approvalId:"",assignedMobitelOfficer:"",approvalType:"Default"}),e.history.push({pathname:"/modifyTask"})}),1e3)})).catch((e=>{console.log(e)}))}},variant:"primary",type:"button",style:{width:"130px",height:"30px"},children:"Re-Assign"})]}),(0,j.jsx)(d.Z.Group,{as:c.Z})]}),(0,j.jsx)(o.Z,{}),(0,j.jsxs)(o.Z,{children:[(0,j.jsxs)(d.Z.Group,{as:c.Z,children:[(0,j.jsx)(d.Z.Label,{children:"Verification by (Level 1)"}),(0,j.jsx)(d.Z.Control,{as:"select",onChange:e=>Q("verificationOneId",e.target.value),value:A.verificationOneId,defaultValue:"Choose...",isInvalid:!!B.verificationOneId,disabled:!0,children:C.map((e=>(0,j.jsx)("option",{value:e._id,children:e.name})))}),(0,j.jsx)(d.Z.Control.Feedback,{type:"invalid",children:B.verificationOneId})]}),(0,j.jsxs)(d.Z.Group,{as:c.Z,children:[(0,j.jsx)(d.Z.Label,{children:"Verification by (Level 2)"}),(0,j.jsx)(d.Z.Control,{as:"select",onChange:e=>Q("verificationTwoId",e.target.value),value:A.verificationTwoId,defaultValue:"Choose...",disabled:!0,children:S.map((e=>(0,j.jsx)("option",{value:e._id,children:e.name})))})]}),(0,j.jsxs)(d.Z.Group,{as:c.Z,children:[(0,j.jsx)(d.Z.Label,{children:"Approval by"}),(0,j.jsx)(d.Z.Control,{as:"select",onChange:e=>Q("approvalId",e.target.value),value:A.approvalId,defaultValue:"Choose...",isInvalid:!!B.approvalId,disabled:!0,children:T.map((e=>(0,j.jsx)("option",{value:e._id,children:e.name})))}),(0,j.jsx)(d.Z.Control.Feedback,{type:"invalid",children:B.approvalId})]})]}),(0,j.jsx)(o.Z,{children:(0,j.jsx)(d.Z,{children:(0,j.jsx)(d.Z.Group,{as:c.Z,children:(0,j.jsx)(d.Z.Label,{style:{fontSize:11},children:"** If you need to change current approval path, Go to (My Account>Add/Update User or Company>Select relevant Mobitel Officer to be assigned) and Update the approval path before re-assign the task."})})})})]}),(0,j.jsx)(o.Z,{children:(0,j.jsx)(d.Z,{children:(0,j.jsx)("br",{})})}),(0,j.jsxs)("div",{style:{border:"1px solid #ccc",padding:"10px"},children:[(0,j.jsxs)(o.Z,{children:[(0,j.jsxs)(d.Z.Group,{as:c.Z,children:[(0,j.jsx)(d.Z.Label,{children:"BOQ Approval Requirement"}),(0,j.jsxs)(d.Z.Control,{id:"formChangeBoqApprovalRequirment",onChange:e=>{Q("boqApprovalRequirment",e.target.value)},value:A.boqApprovalRequirment,as:"select",defaultValue:"item.boqApprovalRequirment",isInvalid:!!B.boqApprovalRequirment,children:[(0,j.jsx)("option",{children:"Choose..."}),(0,j.jsx)("option",{value:!0,children:"Required"}),(0,j.jsx)("option",{value:!1,children:"Not Required"})]}),(0,j.jsx)(d.Z.Control.Feedback,{type:"invalid",children:B.boqApprovalRequirment})]}),(0,j.jsxs)(d.Z.Group,{as:c.Z,children:[(0,j.jsx)(d.Z.Label,{children:"Update"}),(0,j.jsx)("br",{}),(0,j.jsx)(p.Z,{onClick:e=>J(e),variant:"primary",type:"button",style:{width:"130px",height:"30px"},id:"btnChangeBoqApprovalRequirement",children:"Update"})]}),(0,j.jsx)(d.Z.Group,{as:c.Z})]}),(0,j.jsx)(o.Z,{})]}),(0,j.jsx)(o.Z,{children:(0,j.jsx)(d.Z,{children:(0,j.jsx)("br",{})})})]})})})]}),(0,j.jsx)(h.Z,{open:D,autoHideDuration:6e3,onClose:Y,anchorOrigin:{vertical:"top",horizontal:"center"},children:(0,j.jsx)(b,{onClose:Y,severity:M,sx:{width:"100%"},children:_})}),(0,j.jsx)(x.Z,{open:V,onClose:Y,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:(0,j.jsx)(f.Z,{children:(0,j.jsx)(v.Z,{sx:{display:"flex"},children:(0,j.jsx)(m.Z,{})})})})]})}))},62591:(e,a,t)=>{t.d(a,{Z:()=>c});var s=t(87462),i=t(63366),r=t(81694),n=t.n(r),o=t(72791),l=t(10162),d=["bsPrefix","className","striped","bordered","borderless","hover","size","variant","responsive"];const c=o.forwardRef((function(e,a){var t=e.bsPrefix,r=e.className,c=e.striped,p=e.bordered,h=e.borderless,u=e.hover,v=e.size,f=e.variant,m=e.responsive,x=(0,i.Z)(e,d),j=(0,l.vE)(t,"table"),b=n()(r,j,f&&j+"-"+f,v&&j+"-"+v,c&&j+"-striped",p&&j+"-bordered",h&&j+"-borderless",u&&j+"-hover"),g=o.createElement("table",(0,s.Z)({},x,{className:b,ref:a}));if(m){var k=j+"-responsive";return"string"===typeof m&&(k=k+"-"+m),o.createElement("div",{className:k},g)}return g}))}}]);
//# sourceMappingURL=385.226147bb.chunk.js.map